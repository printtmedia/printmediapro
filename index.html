<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Заказ-наряд на полиграфию</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary: #4F46E5;
            --secondary: #6B7280;
            --success: #10B981;
            --danger: #EF4444;
            --background: #D1D5DB;
            --white: #FFFFFF;
            --text: #1F2937;
            --border: #9CA3AF;
            --card-bg: #E5E7EB;
        }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background-image: url('5073412.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            margin: 0;
            padding: 20px;
            color: var(--text);
            min-height: 100vh;
        }

        .order-form {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            opacity: 1;
            position: relative;
        }

        .logo {
            position: absolute;
            top: 10px;
            left: 10px;
            width: 100px;
            height: auto;
        }

        h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            text-align: center;
            margin-bottom: 2rem;
            letter-spacing: 0.025em;
            margin-top: 40px;
        }

        .form-group {
            margin-bottom: 1.5rem;
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: 1rem;
            align-items: center;
        }

        .section-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--primary);
            margin: 2rem 0 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--primary);
        }

        label {
            font-weight: 500;
            color: var(--secondary);
        }

        input, select, textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--white);
            font-size: 1rem;
            transition: all 0.2s ease;
            color: #1F2937;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .custom-field, .binding-options {
            display: none;
            grid-column: 2 / 3;
            margin-top: 0.5rem;
        }

        button {
            background: var(--primary);
            color: var(--white);
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            margin: 0 10px;
        }

        button:hover {
            background: #4338CA;
            transform: translateY(-1px);
        }

        .remove-button {
            background: var(--danger);
            padding: 0.25rem 0.75rem;
            margin-left: 0.5rem;
        }

        .remove-button:hover {
            background: #DC2626;
        }

        .selected-items {
            grid-column: 2 / 3;
            margin-top: 0.5rem;
        }

        .selected-item {
            display: flex;
            align-items: center;
            background: #F3F4F6;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            margin-bottom: 0.5rem;
            border: 1px solid var(--border);
        }

        .file-group {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        @media (max-width: 768px) {
            .form-group {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
            
            .order-form {
                padding: 1rem;
            }

            .file-group {
                flex-direction: column;
                align-items: flex-start;
            }

            .logo {
                width: 80px;
                top: 5px;
                left: 5px;
            }

            h2 {
                margin-top: 30px;
            }
        }

        /* Стили для печати */
        @media print {
            body {
                background: none; /* Убираем фоновое изображение при печати */
                padding: 0;
            }

            .order-form {
                box-shadow: none;
                border: none;
                padding: 0;
                background: none;
            }

            .order-table {
                position: relative;
                padding-top: 60px; /* Отступ для логотипа */
            }

            .logo {
                display: block !important; /* Убедимся, что логотип виден при печати */
                position: absolute;
                top: 10px;
                left: 10px;
                width: 100px;
                height: auto;
            }

            h2 {
                margin-top: 40px; /* Убедимся, что заголовок не перекрывает логотип */
            }

            /* Скрываем ненужные элементы при печати */
            button, .remove-button {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="order-form">
        <img src="https://raw.githubusercontent.com/printtmedia/printmediapro/main/Logo%20printmediapro.png" alt="Логотип PrintMediaPro" class="logo">
        <h2>ЗАКАЗ-НАРЯД № <span id="orderNumber"></span></h2>
        
        <div class="form-group">
            <label>Дата заказа:</label>
            <input type="date" id="orderDate" name="order_date" required>
        </div>

        <div class="form-group">
            <label>Заказчик:</label>
            <input type="text" name="customer" placeholder="Название компании" required>
        </div>

        <div class="form-group">
            <label>Контактное лицо:</label>
            <input type="text" name="contact_person" placeholder="Иванов Иван Иванович" required>
        </div>

        <div class="form-group">
            <label>Телефон:</label>
            <input type="tel" name="phone" pattern="[+]{1}[0-9]{12}" placeholder="+380XXXXXXXXX" required>
        </div>

        <div class="form-group">
            <label>Email:</label>
            <input type="email" name="email" placeholder="example@domain.com" required>
        </div>

        <div class="form-group">
            <label>Название файла:</label>
            <div class="file-group">
                <input type="text" name="filename" id="filename" placeholder="Название макета">
                <input type="file" id="fileUpload" accept=".pdf,.jpg,.png,.docx">
            </div>
        </div>

        <div class="section-title">Характеристики продукции</div>

        <div class="form-group">
            <label>Наименование продукции:</label>
            <select name="product_name" id="productName" required>
                <option value="">Выберите продукцию</option>
                <option value="label">Этикетка</option>
                <option value="booklet">Буклет</option>
                <option value="brochure">Брошура</option>
                <option value="flyer">Флаер</option>
                <option value="euro_flyer">Евро флаер</option>
                <option value="catalog">Каталог</option>
                <option value="magazine">Журнал</option>
                <option value="book">Книга</option>
                <option value="calendar">Календарь</option>
                <option value="newspaper">Газета</option>
                <option value="poster">Плакат</option>
                <option value="board">Борд</option>
                <option value="banner">Баннер</option>
                <option value="leaflet">Листовка</option>
                <option value="business_card">Визитка</option>
                <option value="certificate">Сертификат</option>
                <option value="pvc_table">Табл ПВХ</option>
                <option value="cutting">Плотерная резка</option>
                <option value="stopper">Стопер</option>
                <option value="other">Другое</option>
            </select>
            <div id="bindingOptions" class="binding-options">
                <label>Тип:</label>
                <select id="bindingType">
                    <option value="soft">Мягкий переплет</option>
                    <option value="hard">Твердый переплет</option>
                </select>
            </div>
            <div id="calendarOptions" class="binding-options">
                <label>Тип календаря:</label>
                <select id="calendarType">
                    <option value="cover">Обложка</option>
                    <option value="inner">Внутренний блок</option>
                </select>
                <label>Количество страниц:</label>
                <input type="number" id="pageCount" min="1" placeholder="Введите количество страниц">
            </div>
            <input type="text" name="custom_product" 
                   class="custom-field" 
                   placeholder="Укажите название продукции"
                   id="customProduct"
                   required>
            <div id="selectedProducts" class="selected-items"></div>
        </div>

        <div class="form-group">
            <label>Тип печати (стороны):</label>
            <select name="print_sides" id="printSides" required>
                <option value="">Выберите тип печати</option>
                <option value="4+0">Односторонняя (4+0)</option>
                <option value="4+4">Двусторонняя (4+4)</option>
            </select>
        </div>

        <div class="form-group">
            <label>Тираж:</label>
            <input type="number" name="quantity" min="1" required>
        </div>

        <div class="form-group">
            <label>Формат:</label>
            <select name="format" id="formatSelect">
                <option value="">Выберите формат</option>
                <option value="A1">A1</option>
                <option value="A2">A2</option>
                <option value="A3">A3</option>
                <option value="A4">A4</option>
                <option value="A5">A5</option>
                <option value="A6">A6</option>
                <option value="custom">Другой формат</option>
            </select>
            <input type="text" name="custom_format" 
                   class="custom-field" 
                   placeholder="Укажите размеры (мм)"
                   id="customFormat">
            <div id="selectedFormats" class="selected-items"></div>
        </div>

        <div class="form-group">
            <label>Тип печати:</label>
            <select name="print_type" required>
                <option value="">Выберите тип печати</option>
                <option value="konica">Коника</option>
                <option value="konica_label">Коника лейбел</option>
                <option value="wide_format">Широкоформатная печать</option>
                <option value="plotter_cutting">Плотерная резка</option>
                <option value="newspaper_printing">Печать газеты</option>
                <option value="heidelberg_printing">Печать Heidelberg</option>
            </select>
        </div>

        <div class="form-group">
            <label>Материал:</label>
            <select name="material" id="materialSelect" required>
                <option value="">Выберите материал</option>
                <option value="offset">Офсет</option>
                <option value="glossy_chalk">Мел глянец</option>
                <option value="matte_chalk">Мел мат</option>
                <option value="self_adhesive">Самоклейка</option>
                <option value="blueback">Блюбек</option>
                <option value="citylight">Ситилайт</option>
                <option value="banner">Банер</option>
                <option value="film_white">Пленка: 010 Белая</option>
                <option value="film_matte">Пленка: 010 Мат</option>
                <option value="perforated_film">Пленка: Перфорированная</option>
                <option value="orafol_soundproof">Пленка: orafol фоноподовляющая</option>
                <option value="film_label_white_propylene">Пленка: Белый пропилен</option>
                <option value="film_linen">Пленка: Лён</option>
                <option value="film_kraft">Пленка: Крафт</option>
                <option value="film_grey_propylene">Пленка: Серый пропилен</option>
                <option value="film_transparent_propylene">Пленка: Прозрачный пропилен</option>
                <option value="newspaper">Газета</option>
                <option value="design_cardboard">Дизайн-картон</option>
                <option value="other">Другой материал</option>
            </select>
            <input type="text" name="custom_material" 
                   class="custom-field" 
                   placeholder="Укажите материал"
                   id="customMaterial"
                   required>
        </div>

        <div class="form-group">
            <label>Плотность бумаги:</label>
            <select id="paperWeightSelect" name="paper_weight">
                <option value="">Выберите плотность</option>
                <option value="70">70 г/м²</option>
                <option value="80">80 г/м²</option>
                <option value="90">90 г/м²</option>
                <option value="115">115 г/м²</option>
                <option value="130">130 г/м²</option>
                <option value="150">150 г/м²</option>
                <option value="200">200 г/м²</option>
                <option value="250">250 г/м²</option>
                <option value="300">300 г/м²</option>
                <option value="350">350 г/м²</option>
                <option value="other">Другое</option>
            </select>
            <input type="text" name="custom_paper_weight" 
                   class="custom-field" 
                   placeholder="Укажите плотность (г/м²)"
                   id="customPaperWeight">
            <div id="selectedPaperWeights" class="selected-items"></div>
        </div>

        <div class="form-group">
            <label>Срок исполнения:</label>
            <input type="date" name="deadline" required>
        </div>

        <div class="section-title">Послепечатные работы</div>
        <div class="form-group">
            <label>Послепечатные работы:</label>
            <select id="postPrintSelect">
                <option value="">Выберите вид работ</option>
                <option value="folding">Фальцовка</option>
                <option value="creasing">Биговка</option>
                <option value="stapling">Скоба</option>
                <option value="binding">Биндер</option>
                <option value="perforation">Перфорация</option>
                <option value="die_cutting">Высечка</option>
                <option value="spring">Пружина</option>
                <option value="guillotine">Гильотина</option>
                <option value="manual_cutting">Ручная резка</option>
                <option value="plotter_cutting">Плотерная резка</option>
                <option value="film_lamination">Поклейка пленки на ПВХ</option>
                <option value="banner_gluing">Проклейка банера</option>
                <option value="eyelets">Люверсы</option>
                <option value="glossy_lamination">Ламинация глянец</option>
                <option value="matte_lamination">Ламинация матовая</option>
                <option value="velvet_lamination">Ламинация бархат</option>
                <option value="double_sided_lamination">Ламинация 2 стороны</option>
                <option value="other">Другое</option>
            </select>
            <div id="selectedPostPrint" class="selected-items"></div>
        </div>

        <div id="eyeletsFields" style="display: none; margin-top: 10px;">
            <label for="eyeletsQuantity">Количество люверсов:</label>
            <input type="number" id="eyeletsQuantity" name="eyelets_quantity" min="1" placeholder="Введите количество">
            <label for="eyeletsDistance">Расстояние между люверсами (мм):</label>
            <input type="number" id="eyeletsDistance" name="eyelets_distance" min="1" placeholder="Введите расстояние">
        </div>

        <div class="form-group">
            <label>Примечание:</label>
            <textarea name="notes" rows="4" placeholder="Дополнительные пожелания"></textarea>
        </div>

        <div style="text-align: center; margin-top: 30px;">
            <button type="button" onclick="sendOrder()">Напечатать заказ-наряд</button>
            <button type="button" onclick="sendToGmail()">Отправить на Gmail</button>
            <button type="button" onclick="showInstructions()">Инструкция</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('orderDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('orderNumber').textContent = 
                Math.floor(Math.random() * 100000000).toString().padStart(8, '0');

            const productSelect = document.getElementById('productName');
            const bindingOptions = document.getElementById('bindingOptions');
            const calendarOptions = document.getElementById('calendarOptions');
            const customProduct = document.getElementById('customProduct');
            const formatSelect = document.getElementById('formatSelect');
            const customFormat = document.getElementById('customFormat');
            const paperWeightSelect = document.getElementById('paperWeightSelect');
            const postPrintSelect = document.getElementById('postPrintSelect');

            productSelect.addEventListener('change', () => {
                const value = productSelect.value;
                bindingOptions.style.display = (value === 'magazine' || value === 'book') ? 'block' : 'none';
                calendarOptions.style.display = value === 'calendar' ? 'block' : 'none';
                customProduct.style.display = value === 'other' ? 'block' : 'none';
                customProduct.required = value === 'other';

                if (value && value !== 'magazine' && value !== 'book' && value !== 'calendar' && value !== 'other') {
                    addSimpleProduct();
                }
            });

            document.getElementById('bindingType').addEventListener('change', () => {
                if (productSelect.value === 'magazine' || productSelect.value === 'book') {
                    addProductWithBinding();
                }
            });

            document.getElementById('calendarType').addEventListener('change', () => {
                if (productSelect.value === 'calendar') {
                    addCalendarProduct();
                }
            });

            document.getElementById('pageCount').addEventListener('blur', () => {
                if (productSelect.value === 'calendar') {
                    addCalendarProduct();
                }
            });

            customProduct.addEventListener('blur', () => {
                if (productSelect.value === 'other' && customProduct.value) {
                    addSimpleProduct();
                }
            });

            formatSelect.addEventListener('change', () => {
                const value = formatSelect.value;
                customFormat.style.display = value === 'custom' ? 'block' : 'none';
                customFormat.required = value === 'custom';

                if (value && value !== 'custom') {
                    addFormat();
                }
            });

            customFormat.addEventListener('blur', () => {
                if (formatSelect.value === 'custom' && customFormat.value) {
                    addFormat();
                }
            });

            paperWeightSelect.addEventListener('change', () => {
                if (paperWeightSelect.value && paperWeightSelect.value !== 'other') {
                    addPaperWeight();
                } else if (paperWeightSelect.value === 'other') {
                    document.getElementById('customPaperWeight').style.display = 'block';
                }
            });

            document.getElementById('customPaperWeight').addEventListener('blur', () => {
                if (paperWeightSelect.value === 'other' && document.getElementById('customPaperWeight').value) {
                    addCustomPaperWeight();
                }
            });

            postPrintSelect.addEventListener('change', function() {
                const eyeletsFields = document.getElementById('eyeletsFields');
                eyeletsFields.style.display = this.value === 'eyelets' ? 'block' : 'none';
                if (this.value) {
                    addPostPrint();
                }
            });

            setupCustomField('materialSelect', 'customMaterial', 'other');
            setupCustomField('paperWeightSelect', 'customPaperWeight', 'other');

            document.getElementById('fileUpload').addEventListener('change', function() {
                const fileInput = this;
                const filenameField = document.getElementById('filename');
                if (fileInput.files.length > 0) {
                    filenameField.value = fileInput.files[0].name;
                }
            });
        });

        function setupCustomField(selectId, fieldId, triggerValue) {
            const select = document.getElementById(selectId);
            const field = document.getElementById(fieldId);

            select.addEventListener('change', () => {
                const show = select.value === 'triggerValue';
                field.style.display = show ? 'block' : 'none';
                field.required = show;
            });
        }

        document.querySelector('input[name="phone"]').addEventListener('input', function(e) {
            this.value = this.value.replace(/[^\d+]/g, '');
        });

        function addProductWithBinding() {
            const productSelect = document.getElementById('productName');
            const bindingSelect = document.getElementById('bindingType');
            const selectedValue = productSelect.value;
            let productText = productSelect.options[productSelect.selectedIndex].text;

            if (selectedValue === 'magazine' || selectedValue === 'book') {
                const bindingText = bindingSelect.options[bindingSelect.selectedIndex].text;
                productText += ` (${bindingText})`;
                
                const selectedItemsDiv = document.getElementById('selectedProducts');
                const itemDiv = document.createElement('div');
                itemDiv.className = 'selected-item';
                itemDiv.innerHTML = `<span>${productText}</span><button type="button" class="remove-button" onclick="removeProduct(this)">Удалить</button>`;
                selectedItemsDiv.appendChild(itemDiv);
            }
        }

        function addSimpleProduct() {
            const productSelect = document.getElementById('productName');
            const customProduct = document.getElementById('customProduct');
            const selectedValue = productSelect.value;
            let productText = selectedValue === 'other' ? customProduct.value : productSelect.options[productSelect.selectedIndex].text;

            if (productText) {
                const selectedItemsDiv = document.getElementById('selectedProducts');
                const itemDiv = document.createElement('div');
                itemDiv.className = 'selected-item';
                itemDiv.innerHTML = `<span>${productText}</span><button type="button" class="remove-button" onclick="removeProduct(this)">Удалить</button>`;
                selectedItemsDiv.appendChild(itemDiv);
            }
        }

        function addCalendarProduct() {
            const productSelect = document.getElementById('productName');
            const calendarSelect = document.getElementById('calendarType');
            const pageCount = document.getElementById('pageCount').value;
            const selectedValue = productSelect.value;

            if (selectedValue === 'calendar') {
                const calendarText = calendarSelect.options[calendarSelect.selectedIndex].text;
                let productText = `Календарь (${calendarText}${pageCount ? `, ${pageCount} стр.` : ''})`;
                
                const selectedItemsDiv = document.getElementById('selectedProducts');
                const itemDiv = document.createElement('div');
                itemDiv.className = 'selected-item';
                itemDiv.innerHTML = `<span>${productText}</span><button type="button" class="remove-button" onclick="removeProduct(this)">Удалить</button>`;
                selectedItemsDiv.appendChild(itemDiv);
            }
        }

        function removeProduct(button) {
            button.parentElement.remove();
        }

        function addFormat() {
            const formatSelect = document.getElementById('formatSelect');
            const customFormat = document.getElementById('customFormat');
            const selectedValue = formatSelect.value;
            let formatText = selectedValue === 'custom' ? customFormat.value : formatSelect.options[formatSelect.selectedIndex].text;

            if (formatText) {
                const selectedItemsDiv = document.getElementById('selectedFormats');
                const itemDiv = document.createElement('div');
                itemDiv.className = 'selected-item';
                itemDiv.innerHTML = `<span>${formatText}</span><button type="button" class="remove-button" onclick="removeFormat(this)">Удалить</button>`;
                selectedItemsDiv.appendChild(itemDiv);
            }
        }

        function removeFormat(button) {
            button.parentElement.remove();
        }

        function addPostPrint() {
            const select = document.getElementById('postPrintSelect');
            const selectedText = select.options[select.selectedIndex].text;

            if (select.value) {
                const selectedItemsDiv = document.getElementById('selectedPostPrint');
                const itemDiv = document.createElement('div');
                itemDiv.className = 'selected-item';
                itemDiv.innerHTML = `<span>${selectedText}</span><button type="button" class="remove-button" onclick="removePostPrint(this)">Удалить</button>`;
                selectedItemsDiv.appendChild(itemDiv);
            }
        }

        function removePostPrint(button) {
            button.parentElement.remove();
        }

        function addPaperWeight() {
            const select = document.getElementById('paperWeightSelect');
            const selectedText = select.options[select.selectedIndex].text;

            if (select.value) {
                const selectedItemsDiv = document.getElementById('selectedPaperWeights');
                const itemDiv = document.createElement('div');
                itemDiv.className = 'selected-item';
                itemDiv.innerHTML = `<span>${selectedText}</span><button type="button" class="remove-button" onclick="removePaperWeight(this)">Удалить</button>`;
                selectedItemsDiv.appendChild(itemDiv);
            }
        }

        function addCustomPaperWeight() {
            const customPaperWeight = document.getElementById('customPaperWeight');
            const paperWeightText = customPaperWeight.value + ' г/м²';

            if (paperWeightText) {
                const selectedItemsDiv = document.getElementById('selectedPaperWeights');
                const itemDiv = document.createElement('div');
                itemDiv.className = 'selected-item';
                itemDiv.innerHTML = `<span>${paperWeightText}</span><button type="button" class="remove-button" onclick="removePaperWeight(this)">Удалить</button>`;
                selectedItemsDiv.appendChild(itemDiv);
            }
        }

        function removePaperWeight(button) {
            button.parentElement.remove();
        }

        function generateOrderTable() {
            const formData = {
                orderNumber: document.getElementById('orderNumber').textContent,
                orderDate: document.getElementById('orderDate').value,
                customer: document.querySelector('input[name="customer"]').value,
                contactPerson: document.querySelector('input[name="contact_person"]').value,
                phone: document.querySelector('input[name="phone"]').value,
                email: document.querySelector('input[name="email"]').value,
                filename: document.getElementById('filename').value,
                product: getSelectedProducts(),
                printSides: document.getElementById('printSides').options[document.getElementById('printSides').selectedIndex].text,
                quantity: document.querySelector('input[name="quantity"]').value,
                format: getSelectedFormats(),
                printType: document.querySelector('select[name="print_type"] option:checked').text,
                material: getSelectedValue('materialSelect', 'customMaterial'),
                paperWeight: getSelectedPaperWeights(),
                deadline: document.querySelector('input[name="deadline"]').value,
                postPrint: getSelectedPostPrint(),
                eyeletsQuantity: document.getElementById('eyeletsQuantity').value,
                eyeletsDistance: document.getElementById('eyeletsDistance').value,
                notes: document.querySelector('textarea[name="notes"]').value
            };

            return `
                <div class="order-table" style="font-family: Arial, sans-serif; padding: 20px; background: white; width: 800px; position: relative;">
                    <img src="https://raw.githubusercontent.com/printtmedia/printmediapro/main/Logo%20printmediapro.png" alt="Логотип PrintMediaPro" class="logo">
                    <h2 style="text-align: center; color: #4F46E5; margin-top: 40px;">ЗАКАЗ-НАРЯД №${formData.orderNumber}</h2>
                    <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                        <tr><th style="border: 1px solid #E5E7EB; padding: 8px; background-color: #F9FAFB;">Параметр</th><th style="border: 1px solid #E5E7EB; padding: 8px; background-color: #F9FAFB;">Значение</th></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Дата заказа</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.orderDate}</td></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Заказчик</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.customer}</td></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Контактное лицо</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.contactPerson}</td></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Телефон</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.phone}</td></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Email</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.email}</td></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Название файла</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.filename || 'Не указано'}</td></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Наименование продукции</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.product}</td></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Тип печати (стороны)</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.printSides}</td></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Тираж</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.quantity}</td></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Формат</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.format}</td></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Тип печати</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.printType}</td></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Материал</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.material}</td></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Плотность бумаги</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.paperWeight}</td></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Срок исполнения</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.deadline}</td></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Послепечатные работы</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.postPrint}</td></tr>
                        ${formData.eyeletsQuantity ? `<tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Количество люверсов</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.eyeletsQuantity}</td></tr>` : ''}
                        ${formData.eyeletsDistance ? `<tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Расстояние между люверсами</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.eyeletsDistance} мм</td></tr>` : ''}
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Примечание</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.notes || 'Отсутствует'}</td></tr>
                    </table>
                </div>
            `;
        }

        function sendOrder() {
            const orderTable = generateOrderTable();
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Печать заказа</title>
                    <style>
                        @media print {
                            body {
                                margin: 0;
                                padding: 0;
                            }
                            .order-table {
                                position: relative;
                                padding-top: 60px;
                            }
                            .logo {
                                position: absolute;
                                top: 10px;
                                left: 10px;
                                width: 100px;
                                height: auto;
                            }
                            h2 {
                                margin-top: 40px;
                            }
                        }
                    </style>
                </head>
                <body>
                    ${orderTable}
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.focus();
            printWindow.print();
        }

        function sendToGmail() {
            const formData = {
                orderNumber: document.getElementById('orderNumber').textContent
            };

            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = generateOrderTable();
            document.body.appendChild(tempDiv);

            html2canvas(tempDiv.querySelector('.order-table')).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const folderName = `Заказ-наряд №${formData.orderNumber}`;
                const fileName = `${folderName}.png`;

                if (window.showDirectoryPicker) {
                    saveWithFolder(imgData, folderName, fileName)
                        .then(() => proceedWithEmail(folderName))
                        .catch(error => {
                            console.log('Ошибка File System API:', error);
                            fallbackDownload(imgData, folderName, fileName);
                        });
                } else {
                    fallbackDownload(imgData, folderName, fileName);
                }

                document.body.removeChild(tempDiv);
            }).catch(error => {
                console.error('Ошибка html2canvas:', error);
            });
        }

        async function saveWithFolder(imgData, folderName, fileName) {
            const dirHandle = await window.showDirectoryPicker({ mode: 'readwrite' });
            const subDirHandle = await dirHandle.getDirectoryHandle(folderName, { create: true });
            const fileHandle = await subDirHandle.getFileHandle(fileName, { create: true });
            const writable = await fileHandle.createWritable();
            const response = await fetch(imgData);
            const blob = await response.blob();
            await writable.write(blob);
            await writable.close();
        }

        function fallbackDownload(imgData, folderName, fileName) {
            const link = document.createElement('a');
            link.href = imgData;
            link.download = `${folderName}/${fileName}`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            proceedWithEmail(folderName);
        }

        function proceedWithEmail(folderName) {
            const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
            const subject = `Заказ-наряд №${folderName.split('№')[1]}`;

            if (isMobile) {
                const mailtoUrl = `mailto:printmediapro@gmail.com?subject=${encodeURIComponent(subject)}`;
                window.location.href = mailtoUrl;
            } else {
                const gmailUrl = `https://mail.google.com/mail/?view=cm&fs=1&to=printmediapro@gmail.com&su=${encodeURIComponent(subject)}`;
                window.open(gmailUrl, '_blank');
            }
        }

        function showInstructions() {
            const instructions = `
                <!DOCTYPE html>
                <html lang="ru">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>Инструкция по использованию</title>
                    <style>
                        body {
                            font-family: Arial, sans-serif;
                            margin: 20px;
                            line-height: 1.6;
                            background-color: #f4f4f4;
                            color: #333;
                        }
                        h1 {
                            color: #4F46E5;
                            text-align: center;
                        }
                        h2 {
                            color: #6B7280;
                            margin-top: 20px;
                        }
                        p, li {
                            font-size: 16px;
                        }
                        ul {
                            margin-left: 20px;
                        }
                        .container {
                            max-width: 800px;
                            margin: 0 auto;
                            background: white;
                            padding: 20px;
                            border-radius: 8px;
                            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                        }
                    </style>
                </head>
                <body>
                    <div class="container">
                        <h1>Инструкция по использованию формы "Заказ-наряд на полиграфию"</h1>
                        <p>Эта форма помогает оформить заказ на печать полиграфической продукции (визиток, баннеров, книг и т.д.). Вы заполняете все поля, а потом можете либо распечатать заказ, либо отправить его на почту. Вот пошаговое объяснение, что делать:</p>

                        <h2>1. Заполнение основной информации</h2>
                        <p>Когда вы открываете форму, в верхнем левом углу отображается логотип "PrintMediaPro", а вверху написано "ЗАКАЗ-НАРЯД №" и случайный номер (например, 01234567). Этот номер создается автоматически и нужен для идентификации вашего заказа.</p>
                        <ul>
                            <li><b>Дата заказа</b>: Здесь уже стоит сегодняшняя дата (например, 27.03.2025). Если нужно изменить, нажмите на поле и выберите другую дату в календаре.</li>
                            <li><b>Заказчик</b>: Напишите название компании или имя человека, кто делает заказ (например, "ООО Ромашка" или "Иван Петров").</li>
                            <li><b>Контактное лицо</b>: Укажите имя и фамилию человека, с кем можно связаться (например, "Анна Иванова").</li>
                            <li><b>Телефон</b>: Введите номер телефона в формате <code>+380XXXXXXXXX</code> (например, +380501234567). Начинайте с "+".</li>
                            <li><b>Email</b>: Напишите адрес электронной почты, куда можно отправить подтверждение (например, "anna@example.com").</li>
                            <li><b>Название файла</b>: Укажите название файла с макетом, который вы хотите напечатать (например, "Визитка Анна"). Если у вас есть готовый файл, нажмите на кнопку "Выбрать файл" рядом с этим полем, найдите файл на компьютере или телефоне (например, PDF, JPG, PNG) и выберите его. Название файла появится в поле автоматически.</li>
                        </ul>

                        <h2>2. Характеристики продукции</h2>
                        <p>Эта часть про то, что именно вы хотите напечатать.</p>
                        <ul>
                            <li><b>Наименование продукции</b>: Нажмите на выпадающий список и выберите, что вам нужно (например, "Визитка", "Баннер", "Книга"). Если нужного нет, выберите "Другое" и в появившемся поле напишите, что хотите (например, "Наклейка").
                                <ul>
                                    <li>Если выбрали "Журнал" или "Книга", появится поле "Тип" — выберите "Мягкий переплет" или "Твердый переплет".</li>
                                    <li>Если выбрали "Календарь", появятся поля "Тип календаря" (например, "Обложка") и "Количество страниц" (укажите число, например, 12).</li>
                                    <li>После выбора нажмите на название в списке, и оно добавится внизу в виде "Визитка [Удалить]". Если ошиблись, нажмите "Удалить".</li>
                                </ul>
                            </li>
                            <li><b>Тип печати (стороны)</b>: Выберите, печатать с одной стороны ("Односторонняя 4+0") или с двух ("Двусторонняя 4+4").</li>
                            <li><b>Тираж</b>: Напишите, сколько штук вам нужно (например, 100).</li>
                            <li><b>Формат</b>: Выберите размер (например, "A4"). Если нужного нет, выберите "Другой формат" и напишите размеры в миллиметрах (например, "100x200"). Выбранный формат появится ниже, можно удалить, если ошиблись.</li>
                            <li><b>Тип печати</b>: Выберите способ печати (например, "Коника" или "Широкоформатная печать").</li>
                            <li><b>Материал</b>: Укажите, на чем печатать (например, "Офсет" или "Самоклейка"). Если нужного нет, выберите "Другой материал" и напишите свой вариант (например, "Картон").</li>
                            <li><b>Плотность бумаги</b>: Выберите вес бумаги (например, "80 г/м²"). Выбранное добавится ниже, можно удалить.</li>
                            <li><b>Срок исполнения</b>: Нажмите на поле и выберите дату, к которой нужен заказ (например, 01.04.2025).</li>
                        </ul>

                        <h2>3. Послепечатные работы</h2>
                        <p>Если после печати нужно что-то сделать с продукцией (например, сложить или прикрепить кольца), заполните это:</p>
                        <ul>
                            <li><b>Послепечатные работы</b>: Выберите из списка (например, "Ламинация глянец" или "Пружина"). Если выбрали "Люверсы" (металлические кольца), появятся поля:
                                <ul>
                                    <li>"Количество люверсов": Укажите, сколько колец нужно (например, 4).</li>
                                    <li>"Расстояние между люверсами": Напишите расстояние в миллиметрах (например, 100).</li>
                                    <li>Выбранные работы появятся ниже, можно удалить, если ошиблись.</li>
                                </ul>
                            </li>
                        </ul>

                        <h2>4. Примечание</h2>
                        <ul>
                            <li><b>Примечание</b>: Напишите любые дополнительные пожелания (например, "Срочный заказ" или "Позвонить перед печатью"). Если ничего не нужно, оставьте пустым.</li>
                        </ul>

                        <h2>5. Что делать с заказом</h2>
                        <p>Внизу формы есть три кнопки:</p>
                        <ul>
                            <li><b>Напечатать заказ-наряд</b>:
                                <ul>
                                    <li>Нажмите эту кнопку, если хотите распечатать заказ на принтере.</li>
                                    <li>Откроется новое окно с таблицей, где будет все, что вы заполнили (номер, дата, заказчик и т.д.), включая логотип "PrintMediaPro" в верхнем левом углу.</li>
                                    <li>Нажмите "Печать" в этом окне (или значок принтера в браузере), выберите принтер и распечатайте.</li>
                                </ul>
                            </li>
                            <li><b>Отправить на Gmail</b>:
                                <ul>
                                    <li>Нажмите эту кнопку, если хотите отправить заказ по почте.</li>
                                    <li>Сначала на ваш компьютер или телефон скачается файл с картинкой заказа в папке "Заказ-наряд №XXXXXX" (например, "Заказ-наряд №01234567/Заказ-наряд №01234567.png"), включая логотип.</li>
                                    <li>Если ваш браузер поддерживает File System Access API (например, Chrome), вам предложат выбрать папку, и файл сохранится в автоматически созданной подпапке.</li>
                                    <li>Если браузер не поддерживает API (например, Firefox), файл скачается с указанием пути — создайте папку вручную при сохранении.</li>
                                    <li>Потом:
                                        <ul>
                                            <li><b>На компьютере</b>: Откроется Gmail с темой "Заказ-наряд №01234567". Прикрепите файл вручную.</li>
                                            <li><b>На телефоне</b>: Откроется почтовое приложение с темой. Прикрепите файл из папки "Загрузки".</li>
                                        </ul>
                                    </li>
                                    <li>Письмо уйдет на <code>printmediapro@gmail.com</code>.</li>
                                </ul>
                            </li>
                            <li><b>Инструкция</b>: Эта кнопка открывает данное руководство.</li>
                        </ul>

                        <h2>Советы</h2>
                        <ul>
                            <li>Проверяйте все поля перед отправкой.</li>
                            <li>Заполните все обязательные поля.</li>
                            <li>На телефоне некоторые элементы могут располагаться друг под другом.</li>
                        </ul>

                        <p>Теперь вы знаете, как пользоваться формой!</p>
                    </div>
                </body>
                </html>
            `;

            const instructionWindow = window.open('', '_blank');
            instructionWindow.document.write(instructions);
            instructionWindow.document.close();
        }

        function getSelectedProducts() {
            const selectedItems = document.querySelectorAll('#selectedProducts .selected-item span');
            return Array.from(selectedItems).map(item => item.textContent).join(', ') || 'Не выбрано';
        }

        function getSelectedFormats() {
            const selectedItems = document.querySelectorAll('#selectedFormats .selected-item span');
            return Array.from(selectedItems).map(item => item.textContent).join(', ') || 'Не выбрано';
        }

        function getSelectedPostPrint() {
            const selectedItems = document.querySelectorAll('#selectedPostPrint .selected-item span');
            return Array.from(selectedItems).map(item => item.textContent).join(', ') || 'Не выбрано';
        }

        function getSelectedPaperWeights() {
            const selectedItems = document.querySelectorAll('#selectedPaperWeights .selected-item span');
            return Array.from(selectedItems).map(item => item.textContent).join(', ') || 'Не выбрано';
        }

        function getSelectedValue(selectId, customFieldId) {
            const select = document.getElementById(selectId);
            return select.value === 'other' || select.value === 'custom' 
                ? document.getElementById(customFieldId).value
                : select.options[select.selectedIndex].text;
        }
    </script>
    <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'92d1889f0802b05e',t:'MTc0NDExMjg4NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>
</body>
</html>