<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PrintMediaPro - Order Form for Printing Services</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary: #4F46E5;
            --secondary: #6B7280;
            --success: #10B981;
            --danger: #EF4444;
            --background: #D1D5DB;
            --white: #FFFFFF;
            --text: #1F2937;
            --border: #9CA3AF;
            --card-bg: #E5E7EB;
        }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--background) url('https://printtmedia.github.io/printmediapro/5073412.png') no-repeat center center fixed;
            background-size: cover;
            margin: 0;
            padding: 0;
            color: var(--text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .order-form {
            max-width: 1100px;
            width: 100%;
            margin: 60px auto 0;
            padding: 1rem;
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            position: fixed;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            z-index: 500;
            min-height: 400px;
            max-height: calc(100vh - 80px);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
        }

        .order-form-content {
            flex: 1;
        }

        .order-form-buttons {
            padding: 1rem 0;
            text-align: center;
        }

        .content-spacer {
            height: 100vh;
            visibility: hidden;
        }

        .logo {
            display: none;
        }

        h2 {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary);
            text-align: center;
            margin-bottom: 1rem;
            margin-top: 0;
            letter-spacing: 0.025em;
        }

        .form-group {
            margin-bottom: 0.75rem;
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: 0.5rem;
            align-items: center;
            max-width: 100%;
        }

        .section-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--primary);
            margin: 1rem 0 0.5rem;
            padding-bottom: 0.25rem;
            border-bottom: 2px solid var(--primary);
        }

        label {
            font-weight: 500;
            color: var(--secondary);
            font-size: 0.9rem;
        }

        input, select, textarea {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--white);
            font-size: 0.9rem;
            transition: all 0.2s ease;
            color: #1F2937;
            box-sizing: border-box;
            max-width: 100%;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .custom-field, .binding-options {
            display: none;
            grid-column: 2 / 3;
            margin-top: 0.25rem;
            max-width: 100%;
        }

        button {
            background: var(--primary);
            color: var(--white);
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            margin: 0 5px;
            font-size: 0.9rem;
            box-sizing: border-box;
        }

        button:hover {
            background: #4338CA;
            transform: translateY(-1px);
        }

        .remove-button {
            background: var(--danger);
            padding: 0.25rem 0.5rem;
            margin-left: 0.5rem;
            font-size: 0.8rem;
        }

        .remove-button:hover {
            background: #DC2626;
        }

        .selected-items {
            grid-column: 2 / 3;
            margin-top: 0.25rem;
            max-width: 100%;
            word-break: break-word;
        }

        .selected-item {
            display: flex;
            align-items: center;
            background: #F3F4F6;
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
            margin-bottom: 0.25rem;
            border: 1px solid var(--border);
            font-size: 0.85rem;
            max-width: 100%;
            box-sizing: border-box;
        }

        .file-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            max-width: 100%;
        }

        /* Navigation */
        :root {
            --nav-primary: #FF6200;
            --nav-secondary: #D81B60;
            --nav-text: #1A237E;
            --nav-background: #1C2526;
            --nav-white: #FFFFFF;
            --nav-hover: #E65100;
            --nav-card-bg: #F8FAFA;
            --nav-accent-bg: #E8ECEF;
        }

        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        nav {
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            padding: 0.75rem 0;
            animation: slideDown 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        nav .container {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            flex-direction: row;
            position: relative;
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 2rem;
            align-items: center;
        }

        nav a {
            color: var(--nav-white);
            text-decoration: none;
            font-weight: 500;
            font-size: 1rem;
            text-transform: uppercase;
            transition: color 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        nav a:hover {
            color: var(--nav-primary);
        }

        .menu-toggle {
            display: none;
            cursor: pointer;
            font-size: 1.5rem;
            color: var(--nav-white);
        }

        /* Language Switcher */
        .language-toggle {
            background: transparent;
            border: 1px solid var(--nav-white);
            color: var(--nav-white);
            padding: 0.5rem;
            border-radius: 4px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .language-toggle:focus {
            outline: none;
            border-color: var(--nav-primary);
        }

        .language-toggle option {
            background: var(--nav-background);
            color: var(--nav-white);
        }

        /* Dropdown Menu */
        .dropdown {
            position: relative;
        }

        .dropdown-toggle {
            cursor: pointer;
            color: var(--nav-white);
            font-weight: 500;
            font-size: 1rem;
            text-transform: uppercase;
            transition: color 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-block;
        }

        .dropdown-toggle:hover {
            color: var(--nav-primary);
        }

        .dropdown-menu {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background: var(--nav-background);
            list-style: none;
            min-width: 200px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            animation: fadeIn 0.3s ease-in-out;
        }

        .dropdown-menu li {
            padding: 0.5rem 1rem;
        }

        .dropdown-menu li a {
            color: var(--nav-white);
            font-size: 0.9rem;
            text-transform: none;
            display: block;
        }

        .dropdown-menu li a:hover {
            color: var(--nav-primary);
        }

        .dropdown:hover .dropdown-menu {
            display: block;
        }

        /* Animations */
        @keyframes slideDown {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @media (max-width: 768px) {
            body {
                overflow-x: hidden;
            }

            .order-form {
                width: 100vw;
                max-width: none;
                padding: 0.5rem;
                margin: 60px 0 0;
                position: fixed;
                top: 0;
                left: 0;
                transform: none;
                min-height: 300px;
                max-height: calc(100vh - 60px);
                overflow-y: auto;
                overflow-x: hidden;
                box-sizing: border-box;
            }

            .form-group {
                grid-template-columns: 1fr;
                gap: 0.25rem;
                max-width: 100%;
                margin-bottom: 0.5rem;
            }

            .form-group label, 
            .form-group input, 
            .form-group select, 
            .form-group textarea,
            .custom-field,
            .binding-options,
            .selected-items,
            .selected-item,
            .file-group {
                max-width: 100%;
                width: 100%;
                box-sizing: border-box;
                word-break: break-word;
            }

            .order-form-content,
            .order-form-buttons {
                padding: 0 0.25rem;
            }

            .section-title {
                margin: 0.5rem 0 0.25rem;
            }

            h2 {
                font-size: 1rem;
            }

            label, input, select, textarea, button {
                font-size: 0.8rem;
            }

            .remove-button {
                font-size: 0.7rem;
                padding: 0.2rem 0.4rem;
            }

            .selected-item {
                font-size: 0.75rem;
                padding: 0.2rem 0.4rem;
            }

            .file-group {
                flex-direction: column;
                align-items: flex-start;
            }

            nav {
                padding: 0.5rem 0;
            }

            nav ul {
                display: none;
                flex-direction: column;
                position: absolute;
                top: 100%;
                left: 0;
                width: 100%;
                background: var(--nav-background);
                padding: 1.5rem;
                text-align: center;
            }

            nav ul.active {
                display: flex;
            }

            .menu-toggle {
                display: block;
                position: fixed;
                right: 1.5rem;
                top: 1rem;
                z-index: 1002;
                font-size: 2rem;
                color: var(--nav-white);
                background: rgba(28, 37, 38, 0.9);
                padding: 0.5rem;
                border-radius: 8px;
            }

            .dropdown-menu {
                position: static;
                box-shadow: none;
                background: transparent;
                padding: 0.5rem 0;
                min-width: 100%;
                display: none;
            }

            .dropdown-menu.active {
                display: block;
            }

            .dropdown-menu li {
                padding: 0.5rem 0;
            }

            .dropdown-menu li a {
                font-size: 1rem;
                text-transform: uppercase;
            }

            .language-toggle {
                margin-top: 1rem;
                width: 100%;
                text-align: center;
            }
        }

        @media print {
            body {
                background: none !important;
            }
            .order-form {
                background: var(--card-bg) !important;
                position: static !important;
                transform: none !important;
                margin: 0 !important;
                max-width: 100% !important;
                padding: 1rem !important;
                overflow: visible !important;
            }
            .logo {
                display: block !important;
                position: absolute;
                top: 20px;
                left: 20px;
                width: 150px;
                height: auto;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            .order-table {
                font-size: 12pt !important;
                width: 100% !important;
            }
            table, th, td {
                border: 1px solid black !important;
                font-weight: 600 !important;
            }
            nav {
                display: none !important;
            }
            .content-spacer {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav>
        <div class="container">
            <div class="menu-toggle">
                <i class="fas fa-bars"></i>
            </div>
            <ul>
                <li><a href="index.html#home">Home</a></li>
                <li><a href="index.html#services">Services</a></li>
                <li><a href="index.html#about">About Us</a></li>
                <li><a href="index.html#contact">Contact</a></li>
                <li><a href="order_en.html">Order</a></li>
                <li class="dropdown">
                    <span class="dropdown-toggle">Layout Requirements</span>
                    <ul class="dropdown-menu">
                        <li><a href="requirements.html">Offset Printing</a></li>
                        <li><a href="sticker_requirements.html">Sticker Requirements</a></li>
                        <li><a href="varnish_foil_requirements.html">Layout Prep: Varnish & Foil</a></li>
                    </ul>
                </li>
                <li>
                    <select class="language-toggle" onchange="window.location.href=this.value">
                        <option value="order_uk.html">UK</option>
                        <option value="order_en.html" selected>EN</option>
                        <option value="order_ru.html">RU</option>
                    </select>
                </li>
            </ul>
        </div>
    </nav>

    <div class="order-form">
        <div class="order-form-content">
            <img src="https://printtmedia.github.io/printmediapro/Logo%20printmediapro.png" alt="PrintMediaPro Logo" class="logo">
            <h2>ORDER FORM № <span id="orderNumber"></span></h2>

            <div class="form-group">
                <label>Order Date:</label>
                <input type="date" id="orderDate" name="order_date" required>
            </div>

            <div class="form-group">
                <label>Customer:</label>
                <input type="text" name="customer" placeholder="Company Name" required>
            </div>

            <div class="form-group">
                <label>Contact Person:</label>
                <input type="text" name="contact_person" placeholder="John Doe" required>
            </div>

            <div class="form-group">
                <label>Phone:</label>
                <input type="tel" name="phone" pattern="[+]{1}[0-9]{12}" placeholder="+380XXXXXXXXX" required>
            </div>

            <div class="form-group">
                <label>Email:</label>
                <input type="email" name="email" placeholder="example@domain.com" required>
            </div>

            <div class="form-group">
                <label>File Name:</label>
                <div class="file-group">
                    <input type="file" id="fileUpload" accept=".pdf,.jpg,.png,.docx" multiple>
                </div>
                <div id="fileList" class="selected-items"></div>
            </div>

            <div class="section-title">Product Specifications</div>

            <div class="form-group">
                <label>Product Name:</label>
                <select name="product_name" id="productName" required>
                    <option value="">Select Product</option>
                    <option value="label">Label</option>
                    <option value="booklet">Booklet</option>
                    <option value="brochure">Brochure</option>
                    <option value="flyer">Flyer</option>
                    <option value="euro_flyer">Euro Flyer</option>
                    <option value="catalog">Catalog</option>
                    <option value="magazine">Magazine</option>
                    <option value="book">Book</option>
                    <option value="calendar">Calendar</option>
                    <option value="newspaper">Newspaper</option>
                    <option value="poster">Poster</option>
                    <option value="board">Board</option>
                    <option value="banner">Banner</option>
                    <option value="leaflet">Leaflet</option>
                    <option value="business_card">Business Card</option>
                    <option value="certificate">Certificate</option>
                    <option value="pvc_table">PVC Table</option>
                    <option value="cutting">Plotter Cutting</option>
                    <option value="stopper">Stopper</option>
                    <option value="other">Other</option>
                </select>
                <div id="bindingOptions" class="binding-options">
                    <label>Type:</label>
                    <select id="bindingType">
                        <option value="">Select Binding Type</option>
                        <option value="soft">Soft Binding</option>
                        <option value="hard">Hard Binding</option>
                    </select>
                </div>
                <div id="calendarOptions" class="binding-options">
                    <label>Calendar Type:</label>
                    <select id="calendarType">
                        <option value="">Select Type</option>
                        <option value="cover">Cover</option>
                        <option value="inner">Inner Block</option>
                    </select>
                    <label>Number of Pages:</label>
                    <input type="number" id="pageCount" min="1" placeholder="Enter number of pages">
                </div>
                <input type="text" name="custom_product" 
                       class="custom-field" 
                       placeholder="Specify product name"
                       id="customProduct">
                <div id="selectedProducts" class="selected-items"></div>
            </div>

            <div class="form-group">
                <label>Print Sides:</label>
                <select name="print_sides" id="printSides">
                    <option value="">Select Print Type</option>
                    <option value="4+0">Single-sided (4+0)</option>
                    <option value="4+4">Double-sided (4+4)</option>
                </select>
                <div id="selectedPrintSides" class="selected-items"></div>
            </div>

            <div class="form-group">
                <label>Quantity:</label>
                <input type="number" name="quantity" min="1" required>
            </div>

            <div class="form-group">
                <label>Format:</label>
                <select name="format" id="formatSelect">
                    <option value="">Select Format</option>
                    <option value="A1">A1</option>
                    <option value="A2">A2</option>
                    <option value="A3">A3</option>
                    <option value="A4">A4</option>
                    <option value="A5">A5</option>
                    <option value="A6">A6</option>
                    <option value="custom">Custom Format</option>
                </select>
                <input type="text" name="custom_format" 
                       class="custom-field" 
                       placeholder="Specify dimensions (mm)"
                       id="customFormat">
                <div id="selectedFormats" class="selected-items"></div>
            </div>

            <div class="form-group">
                <label>Print Type:</label>
                <select name="print_type" id="printType">
                    <option value="">Select Print Type</option>
                    <option value="konica">Konica</option>
                    <option value="konica_label">Konica Label</option>
                    <option value="wide_format">Wide Format Printing</option>
                    <option value="plotter_cutting">Plotter Cutting</option>
                    <option value="newspaper_printing">Newspaper Printing</option>
                    <option value="heidelberg_printing">Heidelberg Printing</option>
                </select>
                <div id="selectedPrintTypes" class="selected-items"></div>
            </div>

            <div class="form-group">
                <label>Material:</label>
                <select name="material" id="materialSelect">
                    <option value="">Select Material</option>
                    <option value="offset">Offset</option>
                    <option value="glossy_chalk">Glossy Chalk</option>
                    <option value="matte_chalk">Matte Chalk</option>
                    <option value="self_adhesive">Self-adhesive</option>
                    <option value="blueback">Blueback</option>
                    <option value="citylight">Citylight</option>
                    <option value="banner">Banner</option>
                    <option value="film_white">Film: White</option>
                    <option value="film_matte">Film: Matte</option>
                    <option value="perforated_film">Perforated Film</option>
                    <option value="orafol_soundproof">Film: Orafol Soundproof</option>
                    <option value="film_label_white_propylene">Film: White Propylene</option>
                    <option value="film_linen">Film: Linen</option>
                    <option value="film_kraft">Film: Kraft</option>
                    <option value="film_grey_propylene">Film: Grey Propylene</option>
                    <option value="film_transparent_propylene">Film: Transparent Propylene</option>
                    <option value="newspaper">Newspaper</option>
                    <option value="design_cardboard">Design Cardboard</option>
                    <option value="other">Other Material</option>
                </select>
                <input type="text" name="custom_material" 
                       class="custom-field" 
                       placeholder="Specify material"
                       id="customMaterial">
                <div id="selectedMaterials" class="selected-items"></div>
            </div>

            <div class="form-group">
                <label>Paper Weight:</label>
                <select id="paperWeightSelect" name="paper_weight">
                    <option value="">Select Weight</option>
                    <option value="70">70 g/m²</option>
                    <option value="80">80 g/m²</option>
                    <option value="90">90 g/m²</option>
                    <option value="115">115 g/m²</option>
                    <option value="130">130 g/m²</option>
                    <option value="150">150 g/m²</option>
                    <option value="200">200 g/m²</option>
                    <option value="250">250 g/m²</option>
                    <option value="300">300 g/m²</option>
                    <option value="350">350 g/m²</option>
                    <option value="other">Other</option>
                </select>
                <input type="text" name="custom_paper_weight" 
                       class="custom-field" 
                       placeholder="Specify weight (g/m²)"
                       id="customPaperWeight">
                <div id="selectedPaperWeights" class="selected-items"></div>
            </div>

            <div class="form-group">
                <label>Deadline:</label>
                <input type="date" name="deadline" required>
            </div>

            <div class="section-title">Post-Print Processing</div>
            <div class="form-group">
                <label>Post-Print Processing:</label>
                <select id="postPrintSelect">
                    <option value="">Select Processing Type</option>
                    <option value="folding">Folding</option>
                    <option value="creasing">Creasing</option>
                    <option value="stapling">Stapling</option>
                    <option value="binding">Binding</option>
                    <option value="perforation">Perforation</option>
                    <option value="die_cutting">Die Cutting</option>
                    <option value="spring">Spring Binding</option>
                    <option value="guillotine">Guillotine Cutting</option>
                    <option value="manual_cutting">Manual Cutting</option>
                    <option value="plotter_cutting">Plotter Cutting</option>
                    <option value="film_lamination">Film Lamination on PVC</option>
                    <option value="banner_gluing">Banner Gluing</option>
                    <option value="eyelets">Eyelets</option>
                    <option value="glossy_lamination">Glossy Lamination</option>
                    <option value="matte_lamination">Matte Lamination</option>
                    <option value="velvet_lamination">Velvet Lamination</option>
                    <option value="double_sided_lamination">Double-sided Lamination</option>
                    <option value="pockets">Pockets</option>
                    <option value="other">Other</option>
                </select>
                <input type="text" id="customPostPrint" name="custom_post_print" 
                       class="custom-field" placeholder="Specify processing type" style="display: none;">
                <div id="selectedPostPrint" class="selected-items"></div>
            </div>

            <div id="eyeletsFields" style="display: none; margin-top: 5px;">
                <label for="eyeletsQuantity">Number of Eyelets:</label>
                <input type="number" id="eyeletsQuantity" name="eyelets_quantity" min="1" placeholder="Enter quantity">
                <label for="eyeletsDistance">Distance Between Eyelets (mm):</label>
                <input type="number" id="eyeletsDistance" name="eyelets_distance" min="1" placeholder="Enter distance">
            </div>

            <div id="pocketsFields" style="display: none; margin-top: 5px;">
                <label for="pocketSize">Pocket Size (mm):</label>
                <input type="text" id="pocketSize" name="pocket_size" placeholder="E.g., 100x50">
                <label for="noodleColor">Pocket Noodle Color:</label>
                <select id="noodleColor" name="noodle_color">
                    <option value="">Select Color</option>
                    <option value="white">White</option>
                    <option value="black">Black</option>
                    <option value="red">Red</option>
                    <option value="blue">Blue</option>
                    <option value="green">Green</option>
                    <option value="yellow">Yellow</option>
                    <option value="custom">Custom</option>
                </select>
                <input type="text" id="customNoodleColor" name="custom_noodle_color" 
                       class="custom-field" placeholder="Specify color" style="display: none;">
            </div>

            <div class="form-group">
                <label>Notes:</label>
                <textarea name="notes" rows="3" placeholder="Additional requests"></textarea>
            </div>
        </div>

        <div class="order-form-buttons">
            <button type="button" onclick="sendOrder()">Print Order Form</button>
            <button type="button" onclick="sendToGmail()">Send to Gmail</button>
            <button type="button" onclick="showInstructions()">Instructions</button>
        </div>
    </div>
    <div class="content-spacer"></div>

    <script>
        let selectedFiles = [];

        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM fully loaded');
            document.getElementById('orderDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('orderNumber').textContent = 
                Math.floor(Math.random() * 100000000).toString().padStart(8, '0');

            setupFileUpload();
            setupMultipleSelect('productName', 'selectedProducts', handleProductChange);
            setupMultipleSelect('printSides', 'selectedPrintSides');
            setupMultipleSelect('formatSelect', 'selectedFormats', handleFormatChange);
            setupMultipleSelect('printType', 'selectedPrintTypes', handlePrintTypeChange);
            setupMultipleSelect('materialSelect', 'selectedMaterials', handleMaterialChange);
            setupMultipleSelect('paperWeightSelect', 'selectedPaperWeights', handlePaperWeightChange);
            setupMultipleSelect('postPrintSelect', 'selectedPostPrint', handlePostPrintChange);

            document.querySelector('input[name="phone"]').addEventListener('input', function(e) {
                console.log('Phone input changed:', this.value);
                this.value = this.value.replace(/[^\d+]/g, '');
            });

            setupBindingTypeHandler();
            setupCalendarTypeHandler();

            // Hamburger Menu
            const menuToggle = document.querySelector('.menu-toggle');
            const navUl = document.querySelector('nav ul');

            menuToggle.addEventListener('click', () => {
                console.log('Menu toggle clicked');
                navUl.classList.toggle('active');
            });

            // Dropdown Menu for Mobile
            const dropdownToggles = document.querySelectorAll('.dropdown-toggle');
            dropdownToggles.forEach(toggle => {
                toggle.addEventListener('click', (e) => {
                    if (window.innerWidth <= 768) {
                        console.log('Dropdown toggle clicked');
                        e.preventDefault();
                        const dropdownMenu = toggle.nextElementSibling;
                        dropdownMenu.classList.toggle('active');
                    }
                });
            });
        });

        function setupFileUpload() {
            const fileInput = document.getElementById('fileUpload');
            const fileList = document.getElementById('fileList');

            fileInput.addEventListener('change', function() {
                console.log('File input changed, files:', this.files);
                const newFiles = Array.from(this.files);
                newFiles.forEach(file => {
                    if (!selectedFiles.some(existingFile => existingFile.name === file.name)) {
                        selectedFiles.push(file);
                        addItem(fileList, file.name, 'removeFile', file.name);
                    }
                });
                this.value = '';
            });

            window.removeFile = function(button, fileName) {
                console.log('Removing file:', fileName);
                selectedFiles = selectedFiles.filter(file => file.name !== fileName);
                button.parentElement.remove();
            };
        }

        function setupMultipleSelect(selectId, containerId, customHandler) {
            const select = document.getElementById(selectId);
            const container = document.getElementById(containerId);

            select.addEventListener('change', function() {
                const value = this.value;
                console.log(`Select ${selectId} changed to:`, value);
                if (!value) return;

                if (customHandler) {
                    customHandler(value, container);
                } else {
                    const text = this.options[this.selectedIndex].text;
                    addItem(container, text, `remove${selectId.charAt(0).toUpperCase() + selectId.slice(1)}`, text);
                }
                this.value = '';
            });
        }

        function handleProductChange(value, container) {
            console.log('Handling product change:', value);
            const bindingOptions = document.getElementById('bindingOptions');
            const calendarOptions = document.getElementById('calendarOptions');
            const customProduct = document.getElementById('customProduct');

            bindingOptions.style.display = (value === 'magazine' || value === 'book') ? 'block' : 'none';
            calendarOptions.style.display = value === 'calendar' ? 'block' : 'none';
            customProduct.style.display = value === 'other' ? 'block' : 'none';

            if (value === 'other') {
                customProduct.addEventListener('blur', function handler() {
                    if (this.value) {
                        console.log('Custom product added:', this.value);
                        addItem(container, this.value, 'removeProduct', this.value);
                        this.value = '';
                    }
                    this.removeEventListener('blur', handler);
                });
            } else if (value !== 'magazine' && value !== 'book' && value !== 'calendar') {
                const text = document.getElementById('productName').options[document.getElementById('productName').selectedIndex].text;
                addItem(container, text, 'removeProduct', text);
            }
        }

        function setupBindingTypeHandler() {
            const bindingType = document.getElementById('bindingType');
            const container = document.getElementById('selectedProducts');
            bindingType.addEventListener('change', function() {
                if (this.value) {
                    console.log('Binding type changed:', this.value);
                    const productName = document.getElementById('productName').value === 'magazine' ? 'Magazine' : 'Book';
                    const bindingText = this.options[this.selectedIndex].text;
                    addItem(container, `${productName} (${bindingText})`, 'removeProduct', `${productName} (${bindingText})`);
                    this.value = '';
                }
            });
        }

        function setupCalendarTypeHandler() {
            const calendarType = document.getElementById('calendarType');
            const pageCount = document.getElementById('pageCount');
            const container = document.getElementById('selectedProducts');
            calendarType.addEventListener('change', function() {
                if (this.value) {
                    console.log('Calendar type changed:', this.value);
                    const calendarText = this.options[this.selectedIndex].text;
                    const pages = pageCount.value ? `, ${pageCount.value} pages` : '';
                    addItem(container, `Calendar (${calendarText}${pages})`, 'removeProduct', `Calendar (${calendarText}${pages})`);
                    this.value = '';
                    pageCount.value = '';
                }
            });
        }

        function handleFormatChange(value, container) {
            console.log('Handling format change:', value);
            const customFormat = document.getElementById('customFormat');
            customFormat.style.display = value === 'custom' ? 'block' : 'none';

            if (value === 'custom') {
                customFormat.addEventListener('blur', function handler() {
                    if (this.value) {
                        console.log('Custom format added:', this.value);
                        addItem(container, this.value, 'removeFormat', this.value);
                        this.value = '';
                    }
                    this.removeEventListener('blur', handler);
                });
            } else {
                const text = document.getElementById('formatSelect').options[document.getElementById('formatSelect').selectedIndex].text;
                addItem(container, text, 'removeFormat', text);
            }
        }

        function handlePrintTypeChange(value, container) {
            console.log('Handling print type change:', value);
            const text = document.getElementById('printType').options[document.getElementById('printType').selectedIndex].text;
            addItem(container, text, 'removePrintType', text);
        }

        function handleMaterialChange(value, container) {
            console.log('Handling material change:', value);
            const customMaterial = document.getElementById('customMaterial');
            customMaterial.style.display = value === 'other' ? 'block' : 'none';

            if (value === 'other') {
                customMaterial.addEventListener('blur', function handler() {
                    if (this.value) {
                        console.log('Custom material added:', this.value);
                        addItem(container, this.value, 'removeMaterial', this.value);
                        this.value = '';
                    }
                    this.removeEventListener('blur', handler);
                });
            } else {
                const text = document.getElementById('materialSelect').options[document.getElementById('materialSelect').selectedIndex].text;
                addItem(container, text, 'removeMaterial', text);
            }
        }

        function handlePaperWeightChange(value, container) {
            console.log('Handling paper weight change:', value);
            const customPaperWeight = document.getElementById('customPaperWeight');
            customPaperWeight.style.display = value === 'other' ? 'block' : 'none';

            if (value === 'other') {
                customPaperWeight.addEventListener('blur', function handler() {
                    if (this.value) {
                        console.log('Custom paper weight added:', this.value);
                        addItem(container, `${this.value} g/m²`, 'removePaperWeight', `${this.value} g/m²`);
                        this.value = '';
                    }
                    this.removeEventListener('blur', handler);
                });
            } else {
                const text = document.getElementById('paperWeightSelect').options[document.getElementById('paperWeightSelect').selectedIndex].text;
                addItem(container, text, 'removePaperWeight', text);
            }
        }

        function handlePostPrintChange(value, container) {
            console.log('Handling post-print change:', value);
            const eyeletsFields = document.getElementById('eyeletsFields');
            const pocketsFields = document.getElementById('pocketsFields');
            const customPostPrint = document.getElementById('customPostPrint');
            eyeletsFields.style.display = value === 'eyelets' ? 'block' : 'none';
            pocketsFields.style.display = value === 'pockets' ? 'block' : 'none';
            customPostPrint.style.display = value === 'other' ? 'block' : 'none';

            if (value === 'pockets') {
                document.getElementById('noodleColor').addEventListener('change', function handler() {
                    console.log('Noodle color changed:', this.value);
                    const customNoodleColor = document.getElementById('customNoodleColor');
                    customNoodleColor.style.display = this.value === 'custom' ? 'block' : 'none';
                    if (this.value === 'custom') {
                        customNoodleColor.addEventListener('blur', function subHandler() {
                            if (this.value) {
                                const pocketSize = document.getElementById('pocketSize').value;
                                const text = `Pockets (Size: ${pocketSize || 'not specified'} mm, Noodle Color: ${this.value})`;
                                console.log('Custom noodle color added:', text);
                                addItem(container, text, 'removePostPrint', text);
                                this.value = '';
                            }
                            this.removeEventListener('blur', subHandler);
                        });
                    } else if (this.value) {
                        const pocketSize = document.getElementById('pocketSize').value;
                        const text = `Pockets (Size: ${pocketSize || 'not specified'} mm, Noodle Color: ${this.options[this.selectedIndex].text})`;
                        addItem(container, text, 'removePostPrint', text);
                        this.value = '';
                    }
                    this.removeEventListener('change', handler);
                });
            } else if (value === 'other') {
                customPostPrint.addEventListener('blur', function handler() {
                    if (this.value) {
                        console.log('Custom post-print added:', this.value);
                        addItem(container, this.value, 'removePostPrint', this.value);
                        this.value = '';
                    }
                    this.removeEventListener('blur', handler);
                });
            } else {
                const text = document.getElementById('postPrintSelect').options[document.getElementById('postPrintSelect').selectedIndex].text;
                addItem(container, text, 'removePostPrint', text);
            }
        }

        function addItem(container, text, removeFunctionName, identifier) {
            console.log('Adding item:', text);
            const itemDiv = document.createElement('div');
            itemDiv.className = 'selected-item';
            itemDiv.innerHTML = `<span>${text}</span><button type="button" class="remove-button" onclick="${removeFunctionName}(this, '${identifier.replace(/'/g, "\\'")}')">Remove</button>`;
            container.appendChild(itemDiv);
        }

        window.removeProduct = function(button) { console.log('Removing product'); button.parentElement.remove(); };
        window.removePrintSides = function(button) { console.log('Removing print sides'); button.parentElement.remove(); };
        window.removeFormat = function(button) { console.log('Removing format'); button.parentElement.remove(); };
        window.removePrintType = function(button) { console.log('Removing print type'); button.parentElement.remove(); };
        window.removeMaterial = function(button) { console.log('Removing material'); button.parentElement.remove(); };
        window.removePaperWeight = function(button) { console.log('Removing paper weight'); button.parentElement.remove(); };
        window.removePostPrint = function(button) { console.log('Removing post-print'); button.parentElement.remove(); };

        function generateOrderTable() {
            console.log('Generating order table');
            const formData = {
                orderNumber: document.getElementById('orderNumber').textContent,
                orderDate: document.getElementById('orderDate').value,
                customer: document.querySelector('input[name="customer"]').value,
                contactPerson: document.querySelector('input[name="contact_person"]').value,
                phone: document.querySelector('input[name="phone"]').value,
                email: document.querySelector('input[name="email"]').value,
                filename: selectedFiles.map(file => file.name).join(', ') || 'Not specified',
                product: getSelectedItems('selectedProducts'),
                printSides: getSelectedItems('selectedPrintSides'),
                quantity: document.querySelector('input[name="quantity"]').value,
                format: getSelectedItems('selectedFormats'),
                printType: getSelectedItems('selectedPrintTypes'),
                material: getSelectedItems('selectedMaterials'),
                paperWeight: getSelectedItems('selectedPaperWeights'),
                deadline: document.querySelector('input[name="deadline"]').value,
                postPrint: getSelectedItems('selectedPostPrint'),
                eyeletsQuantity: document.getElementById('eyeletsQuantity').value,
                eyeletsDistance: document.getElementById('eyeletsDistance').value,
                pocketSize: document.getElementById('pocketSize').value,
                notes: document.querySelector('textarea[name="notes"]').value || 'None'
            };

            return `
                <div class="order-table" style="font-family: Arial, sans-serif; padding: 20px; background: white; width: 800px; position: relative;">
                    <img src="https://printtmedia.github.io/printmediapro/Logo%20printmediapro.png" alt="PrintMediaPro Logo" style="position: absolute; top: 20px; left: 20px; width: 150px; height: auto;">
                    <h2 style="text-align: center; color: #4F46E5; margin-top: 80px;">ORDER FORM №${formData.orderNumber}</h2>
                    <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                        <tr><th style="border: 1px solid #E5E7EB; padding: 8px; background-color: #F9FAFB;">Parameter</th><th style="border: 1px solid #E5E7EB; padding: 8px; background-color: #F9FAFB;">Value</th></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Order Date</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.orderDate}</td></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Customer</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.customer}</td></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Contact Person</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.contactPerson}</td></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Phone</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.phone}</td></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Email</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.email}</td></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">File Name</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.filename}</td></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Product Name</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.product}</td></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Print Sides</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.printSides}</td></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Quantity</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.quantity}</td></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Format</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.format}</td></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Print Type</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.printType}</td></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Material</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.material}</td></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Paper Weight</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.paperWeight}</td></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Deadline</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.deadline}</td></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Post-Print Processing</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.postPrint}</td></tr>
                        ${formData.eyeletsQuantity ? `<tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Number of Eyelets</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.eyeletsQuantity}</td></tr>` : ''}
                        ${formData.eyeletsDistance ? `<tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Distance Between Eyelets</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.eyeletsDistance} mm</td></tr>` : ''}
                        ${formData.pocketSize ? `<tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Pocket Size</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.pocketSize} mm</td></tr>` : ''}
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Notes</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.notes}</td></tr>
                    </table>
                </div>
            `;
        }

        function getSelectedItems(containerId) {
            console.log('Getting selected items for:', containerId);
            const items = document.querySelectorAll(`#${containerId} .selected-item span`);
            return Array.from(items).map(item => item.textContent).join(', ') || 'Not selected';
        }

        function sendOrder() {
            console.log('Send Order clicked');
            try {
                const orderTable = generateOrderTable();
                const printWindow = window.open('', '_blank');
                if (!printWindow) throw new Error('Failed to open print window.');
                printWindow.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head><title>Print Order</title><style>@media print { body { margin: 0; padding: 0; } .order-table { width: 100%; } table, th, td { border: 1px solid black; font-size: 12pt; font-weight: 600; } .logo { display: block !important; position: absolute; top: 20px; left: 20px; width: 150px; height: auto; } }</style></head>
                    <body>${orderTable}</body>
                    </html>
                `);
                printWindow.document.close();
                printWindow.focus();
                setTimeout(() => {
                    printWindow.print();
                    printWindow.close();
                }, 500);
            } catch (error) {
                console.error('Error during printing:', error);
                alert('Failed to print the order.');
            }
        }

        function sendToGmail() {
            console.log('Send to Gmail clicked');
            try {
                if (typeof html2canvas === 'undefined') {
                    throw new Error('html2canvas is not loaded.');
                }
                const formData = { orderNumber: document.getElementById('orderNumber').textContent };
                const tempDiv = document.createElement('div');
                tempDiv.style.position = 'absolute';
                tempDiv.style.left = '-9999px';
                tempDiv.innerHTML = generateOrderTable();
                document.body.appendChild(tempDiv);

                html2canvas(tempDiv.querySelector('.order-table'), {
                    scale: 2,
                    useCORS: true,
                    logging: false
                }).then(canvas => {
                    const imgData = canvas.toDataURL('image/png', 1.0);
                    const folderName = `Order Form №${formData.orderNumber}`;
                    const fileName = `${folderName}.png`;

                    if (window.showDirectoryPicker) {
                        saveWithFolder(imgData, folderName, fileName).then(() => proceedWithEmail(folderName));
                    } else {
                        fallbackDownload(imgData, folderName, fileName);
                    }
                    document.body.removeChild(tempDiv);
                }).catch(error => {
                    console.error('html2canvas error:', error);
                    document.body.removeChild(tempDiv);
                    alert('Error creating image. Please ensure html2canvas is loaded correctly.');
                });
            } catch (error) {
                console.error('Error during sending:', error);
                alert('Failed to send the order.');
            }
        }

        async function saveWithFolder(imgData, folderName, fileName) {
            console.log('Saving with folder:', folderName, fileName);
            try {
                const dirHandle = await window.showDirectoryPicker({ mode: 'readwrite' });
                const subDirHandle = await dirHandle.getDirectoryHandle(folderName, { create: true });
                const fileHandle = await subDirHandle.getFileHandle(fileName, { create: true });
                const writable = await fileHandle.createWritable();
                const response = await fetch(imgData);
                const blob = await response.blob();
                await writable.write(blob);
                await writable.close();
            } catch (error) {
                console.error('Error saving with folder:', error);
                fallbackDownload(imgData, folderName, fileName);
            }
        }

        function fallbackDownload(imgData, folderName, fileName) {
            console.log('Fallback download:', fileName);
            const link = document.createElement('a');
            link.href = imgData;
            link.download = fileName;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            proceedWithEmail(folderName);
        }

        function proceedWithEmail(folderName) {
            console.log('Proceeding with email for:', folderName);
            const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
            const subject = `Order Form №${folderName.split('№')[1]}`;
            if (isMobile) {
                window.location.href = `mailto:printmediapro@gmail.com?subject=${encodeURIComponent(subject)}`;
            } else {
                window.open(`https://mail.google.com/mail/?view=cm&fs=1&to=printmediapro@gmail.com&su=${encodeURIComponent(subject)}`, '_blank');
            }
        }

        function showInstructions() {
            console.log('Show Instructions clicked');
            try {
                const instructionWindow = window.open('', '_blank');
                if (!instructionWindow) throw new Error('Failed to open instruction window.');
                instructionWindow.document.write(`
                    <!DOCTYPE html>
                    <html lang="en">
                    <head>
                        <meta charset="UTF-8">
                        <title>Instructions for Using the Form</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; background-color: #f4f4f4; color: #333; }
                            h1 { color: #4F46E5; text-align: center; }
                            h2 { color: #6B7280; margin-top: 20px; }
                            p, li { font-size: 16px; }
                            ul { margin-left: 20px; }
                            .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
                        </style>
                    </head>
                    <body>
                        <div class="container">
                            <h1>Instructions for Using the "Order Form for Printing Services"</h1>
                            <p>This form is designed for placing orders for printing services (business cards, banners, books, etc.). You can fill in the fields, select multiple options where applicable, and either print the order or send it to Gmail. Here’s a step-by-step guide:</p>

                            <h2>1. Basic Information</h2>
                            <ul>
                                <li><b>Order Date</b>: Automatically set to the current date (e.g., 04/23/2025). Change if needed by selecting a date from the calendar.</li>
                                <li><b>Customer</b>: Enter the company name or customer’s name (e.g., "ABC Corp" or "John Doe").</li>
                                <li><b>Contact Person</b>: Enter the name of the contact person (e.g., "Jane Smith").</li>
                                <li><b>Phone</b>: Enter the phone number in the format +380XXXXXXXXX (e.g., +380501234567). Use only digits and "+".</li>
                                <li><b>Email</b>: Enter the email for contact (e.g., "jane@example.com").</li>
                                <li><b>File Name</b>: Click "Choose File" to upload layouts (PDF, JPG, PNG, DOCX). You can select multiple files (hold Ctrl and click files on Windows, or Command on Mac). After selection, the files will appear in the list below with a "Remove" button. <b>Important</b>: This field only displays the names of selected files in the form and the final order table. The files themselves are not automatically attached to the email. You will need to manually attach these files when sending the email to Gmail (see section "Send to Gmail"). To remove a file from the list, click "Remove" next to its name.</li>
                            </ul>

                            <h2>2. Product Specifications</h2>
                            <p>All fields allow selecting multiple values if needed. Selected items appear in the list below with a "Remove" button.</p>
                            <ul>
                                <li><b>Product Name</b>: Select from the list (e.g., "Business Card", "Banner"). After selection, the item will be added to the list (e.g., "Business Card [Remove]"). You can add multiple items. To remove, click "Remove".
                                    <ul>
                                        <li>If you select "Magazine" or "Book", a "Type" field will appear: choose "Soft Binding" or "Hard Binding" — it will be added as, e.g., "Book (Soft Binding) [Remove]".</li>
                                        <li>If you select "Calendar", specify "Calendar Type" ("Cover" or "Inner Block") and "Number of Pages" (e.g., 12) — it will be added as "Calendar (Cover, 12 pages) [Remove]".</li>
                                        <li>If you select "Other", enter the name (e.g., "Sticker") and press Tab or click outside the field — it will be added as "Sticker [Remove]".</li>
                                    </ul>
                                </li>
                                <li><b>Print Sides</b>: Choose "Single-sided (4+0)" or "Double-sided (4+4)". It will be added to the list (e.g., "4+0 [Remove]"). You can select both options. Remove errors by clicking "Remove".</li>
                                <li><b>Quantity</b>: Specify the number of copies (e.g., 100).</li>
                                <li><b>Format</b>: Select from the list (e.g., "A4") or "Custom Format" and specify dimensions (e.g., "100x200 mm"). It will be added to the list (e.g., "A4 [Remove]"). You can select multiple formats. Remove extras by clicking "Remove".</li>
                                <li><b>Print Type</b>: Select from the list (e.g., "Konica", "Wide Format Printing"). It will be added to the list (e.g., "Konica [Remove]"). You can select multiple types. Remove unnecessary ones by clicking "Remove".</li>
                                <li><b>Material</b>: Select the material (e.g., "Offset") or "Other Material" and specify your own (e.g., "Cardboard"). It will be added to the list. Remove if needed.</li>
                                <li><b>Paper Weight</b>: Select from the list (e.g., "80 g/m²") or "Other" and specify the value (e.g., "200"). It will be added to the list (e.g., "80 g/m² [Remove]"). You can select multiple weights. Remove extras.</li>
                                <li><b>Deadline</b>: Select the date from the calendar (e.g., 04/30/2025).</li>
                            </ul>

                            <h2>3. Post-Print Processing</h2>
                            <ul>
                                <li><b>Post-Print Processing</b>: Select the type of processing (e.g., "Glossy Lamination"). It will be added to the list. You can select multiple types.
                                    <ul>
                                        <li>If you select "Eyelets", specify "Number of Eyelets" (e.g., 4) and "Distance Between Eyelets" (e.g., 100 mm) — this data will be included in the table.</li>
                                        <li>If you select "Pockets", specify "Pocket Size" (e.g., "100x50") and "Noodle Color" (e.g., "Red" or "Custom" and your color, e.g., "Silver") — it will be added as "Pockets (Size: 100x50 mm, Noodle Color: Red) [Remove]".</li>
                                        <li>If you select "Other", enter the type of processing (e.g., "Custom Die Cutting") and press Tab or click outside the field — it will be added as "Custom Die Cutting [Remove]".</li>
                                    </ul>
                                    Remove unnecessary items by clicking "Remove".
                                </li>
                            </ul>

                            <h2>4. Notes</h2>
                            <ul>
                                <li><b>Notes</b>: Enter additional requests (e.g., "Urgent order"). Leave blank if not needed.</li>
                            </ul>

                            <h2>5. Actions with the Order</h2>
                            <ul>
                                <li><b>Print Order Form</b>: Click to open a window with the order table. Click "Print" in the browser to send to the printer.</li>
                                <li><b>Send to Gmail</b>: Click to save a PNG file of the table in a folder named "Order Form №XXXXXX". Then Gmail (on a computer) or your email app (on a mobile device) will open with the pre-filled address printmediapro@gmail.com and subject "Order Form №XXXXXX". <b>Important</b>: You need to manually attach the files you selected in the "File Name" field, as well as the PNG file of the order ("Order Form №XXXXXX.png"). To do this:
                                    <ul>
                                        <li>In the opened Gmail window, click the paperclip icon ("Attach files").</li>
                                        <li>Select the files you specified in the "File Name" field (e.g., layouts in PDF, JPG, PNG, or DOCX format).</li>
                                        <li>Also, locate and select the saved PNG file of the order ("Order Form №XXXXXX.png") from the folder where it was saved.</li>
                                        <li>After attaching all files, click "Send".</li>
                                    </ul>
                                    If Gmail does not open, manually send an email to printmediapro@gmail.com, attaching all necessary files.
                                </li>
                                <li><b>Instructions</b>: Click to open this window with the instructions.</li>
                            </ul>

                            <h2>Tips</h2>
                            <ul>
                                <li>Double-check your data before printing or sending.</li>
                                <li>If you made a mistake in the selection, remove the item by clicking "Remove" — no need to reload the page.</li>
                                <li>On mobile devices, the form takes up the full screen width. Scroll the form to see all fields and buttons.</li>
                                <li>Ensure you attach all necessary files before sending the email, or the recipient may not be able to process the order.</li>
                            </ul>

                            <p>Now you’re ready to use the form without errors!</p>
                        </div>
                    </body>
                    </html>
                `);
                instructionWindow.document.close();
            } catch (error) {
                console.error('Instruction error:', error);
                alert('Failed to open instructions.');
            }
        }
    </script>
</body>
</html>