<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row =>
                    row.some(cell => cell !== '' && cell !== null && cell !== undefined)
                );

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="PrintMediaPro â€“ high-quality printing services: business cards, banners, labels, stands, and more in Kropyvnytskyi.">
    <meta name="keywords" content="printing, print services, business cards, banners, labels, stands, Kropyvnytskyi">
    <!-- Prevent caching -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Order Form for Printing Services</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Poppins:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary: #4F46E5;
            --secondary: #6B7280;
            --success: #10B981;
            --danger: #EF4444;
            --background: #D1D5DB;
            --white: #FFFFFF;
            --text: #1F2937;
            --border: #9CA3AF;
            --card-bg: #E5E7EB;
            --hover: #4338CA;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--background) url('https://printtmedia.github.io/printmediapro/5073412.png') no-repeat center center fixed;
            background-size: cover;
            margin: 0;
            padding: 20px;
            color: var(--text);
            min-height: 100vh;
        }

        /* Navigation */
        nav {
            background: rgba(28, 37, 38, 0.9);
            backdrop-filter: blur(12px);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            padding: 0.75rem 0;
            animation: slideDown 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            align-items: center;
        }

        .logo img {
            height: 50px;
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .logo img:hover {
            transform: scale(1.1);
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 2rem;
            align-items: center;
        }

        nav a {
            color: var(--white);
            text-decoration: none;
            font-weight: 500;
            font-size: 1rem;
            text-transform: uppercase;
            transition: color 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        nav a:hover {
            color: var(--primary);
        }

        .menu-toggle {
            display: none;
            cursor: pointer;
            font-size: 1.5rem;
            color: var(--white);
        }

        /* Language Switcher */
        .language-selector {
            position: relative;
            z-index: 1000;
        }

        #language-toggle {
            background: var(--primary);
            color: var(--white);
            border: none;
            padding: 0.5rem 1rem;
            font-weight: 600;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        #language-toggle:hover {
            background: var(--hover);
        }

        .language-options {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--card-bg);
            border-radius: 5px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            padding: 0.5rem;
            z-index: 1000;
        }

        .language-options a {
            display: block;
            padding: 0.5rem 1rem;
            color: var(--text);
            text-decoration: none;
            transition: background 0.3s ease;
        }

        .language-options a:hover {
            background: var(--background);
            border-radius: 5px;
        }

        /* Form */
        .order-form {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            position: relative;
            margin-top: 80px;
        }

        h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            text-align: center;
            margin-bottom: 2rem;
            margin-top: 20px;
            letter-spacing: 0.025em;
        }

        .form-group {
            margin-bottom: 1.5rem;
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: 1rem;
            align-items: center;
        }

        .section-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--primary);
            margin: 2rem 0 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--primary);
        }

        label {
            font-weight: 500;
            color: var(--secondary);
        }

        input, select, textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--white);
            font-size: 1rem;
            transition: all 0.2s ease;
            color: #1F2937;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .custom-field, .binding-options {
            display: none;
            grid-column: 2 / 3;
            margin-top: 0.5rem;
        }

        button {
            background: var(--primary);
            color: var(--white);
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            margin: 0 10px;
        }

        button:hover {
            background: var(--hover);
            transform: translateY(-1px);
        }

        .remove-button {
            background: var(--danger);
            padding: 0.25rem 0.75rem;
            margin-left: 0.5rem;
        }

        .remove-button:hover {
            background: #DC2626;
        }

        .selected-items {
            grid-column: 2 / 3;
            margin-top: 0.5rem;
        }

        .selected-item {
            display: flex;
            align-items: center;
            background: #F3F4F6;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            margin-bottom: 0.5rem;
            border: 1px solid var(--border);
        }

        .file-group {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        /* Footer */
        footer {
            background: var(--background);
            color: var(--white);
            padding: 3rem 0;
            text-align: center;
            margin-top: 20px;
        }

        footer p {
            font-size: 1rem;
            opacity: 0.8;
        }

        .social-links {
            margin-top: 1.5rem;
            display: flex;
            justify-content: center;
            gap: 2rem;
        }

        .social-links a {
            color: var(--white);
            font-size: 1.8rem;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .social-links a:hover {
            color: var(--primary);
            transform: scale(1.2);
        }

        /* Animations */
        @keyframes slideDown {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Media Queries */
        @media (max-width: 768px) {
            nav {
                padding: 0.5rem 0;
            }

            .container {
                flex-direction: column;
                align-items: flex-start;
            }

            .logo img {
                height: 40px;
            }

            nav ul {
                display: none;
                flex-direction: column;
                position: absolute;
                top: 100%;
                left: 0;
                width: 100%;
                background: rgba(28, 37, 38, 0.9);
                padding: 1.5rem;
                text-align: center;
            }

            nav ul.active {
                display: flex;
            }

            .menu-toggle {
                display: block;
            }

            .language-selector {
                margin-top: 1rem;
            }

            .order-form {
                padding: 1rem;
                margin-top: 120px;
            }

            .form-group {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }

            .file-group {
                flex-direction: column;
                align-items: flex-start;
            }
        }

        @media print {
            body {
                background: none !important;
            }
            .order-form {
                background: var(--card-bg) !important;
            }
            .logo {
                display: block !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            .order-table {
                font-size: 12pt !important;
                width: 100% !important;
            }
            table, th, td {
                border: 1px solid black !important;
                font-weight: 600 !important;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav>
        <div class="container">
            <div class="logo">
                <a href="index.html">
                    <img src="https://printtmedia.github.io/printmediapro/Logo%20printmediapro%20golovna.png" alt="PrintMediaPro Logo">
                </a>
            </div>
            <div class="menu-toggle">
                <i class="fas fa-bars"></i>
            </div>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="index.html#services">Services</a></li>
                <li><a href="index.html#about">About Us</a></li>
                <li><a href="index.html#contact">Contact</a></li>
                <li><a href="requirements.html">Layout Requirements</a></li>
            </ul>
            <div class="language-selector">
                <button id="language-toggle" aria-label="Change language">EN</button>
                <div id="language-options" class="language-options">
                    <a href="order_uk.html" lang="uk">UK</a>
                    <a href="order_en.html" lang="en">EN</a>
                    <a href="order_ru.html" lang="ru">RU</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Form -->
    <div class="order-form">
        <h2>ORDER FORM â„– <span id="orderNumber"></span></h2>
        
        <div class="form-group">
            <label>Order Date:</label>
            <input type="date" id="orderDate" name="order_date" required>
        </div>

        <div class="form-group">
            <label>Customer:</label>
            <input type="text" name="customer" placeholder="Company Name" required>
        </div>

        <div class="form-group">
            <label>Contact Person:</label>
            <input type="text" name="contact_person" placeholder="John Doe" required>
        </div>

        <div class="form-group">
            <label>Phone:</label>
            <input type="tel" name="phone" pattern="[+]{1}[0-9]{12}" placeholder="+380XXXXXXXXX" required>
        </div>

        <div class="form-group">
            <label>Email:</label>
            <input type="email" name="email" placeholder="example@domain.com" required>
        </div>

        <div class="form-group">
            <label>File Name:</label>
            <div class="file-group">
                <input type="file" id="fileUpload" accept=".pdf,.jpg,.png,.docx" multiple>
            </div>
            <div id="fileList" class="selected-items"></div>
        </div>

        <div class="section-title">Product Specifications</div>

        <div class="form-group">
            <label>Product Name:</label>
            <select name="product_name" id="productName" required>
                <option value="">Select Product</option>
                <option value="label">Label</option>
                <option value="booklet">Booklet</option>
                <option value="brochure">Brochure</option>
                <option value="flyer">Flyer</option>
                <option value="euro_flyer">Euro Flyer</option>
                <option value="catalog">Catalog</option>
                <option value="magazine">Magazine</option>
                <option value="book">Book</option>
                <option value="calendar">Calendar</option>
                <option value="newspaper">Newspaper</option>
                <option value="poster">Poster</option>
                <option value="board">Board</option>
                <option value="banner">Banner</option>
                <option value="leaflet">Leaflet</option>
                <option value="business_card">Business Card</option>
                <option value="certificate">Certificate</option>
                <option value="pvc_table">PVC Table</option>
                <option value="cutting">Plotter Cutting</option>
                <option value="stopper">Stopper</option>
                <option value="other">Other</option>
            </select>
            <div id="bindingOptions" class="binding-options">
                <label>Type:</label>
                <select id="bindingType">
                    <option value="">Select Binding Type</option>
                    <option value="soft">Soft Binding</option>
                    <option value="hard">Hard Binding</option>
                </select>
            </div>
            <div id="calendarOptions" class="binding-options">
                <label>Calendar Type:</label>
                <select id="calendarType">
                    <option value="">Select Type</option>
                    <option value="cover">Cover</option>
                    <option value="inner">Inner Block</option>
                </select>
                <label>Number of Pages:</label>
                <input type="number" id="pageCount" min="1" placeholder="Enter number of pages">
            </div>
            <input type="text" name="custom_product" 
                   class="custom-field" 
                   placeholder="Specify product name"
                   id="customProduct">
            <div id="selectedProducts" class="selected-items"></div>
        </div>

        <div class="form-group">
            <label>Print Sides:</label>
            <select name="print_sides" id="printSides">
                <option value="">Select Print Type</option>
                <option value="4+0">Single-sided (4+0)</option>
                <option value="4+4">Double-sided (4+4)</option>
            </select>
            <div id="selectedPrintSides" class="selected-items"></div>
        </div>

        <div class="form-group">
            <label>Quantity:</label>
            <input type="number" name="quantity" min="1" required>
        </div>

        <div class="form-group">
            <label>Format:</label>
            <select name="format" id="formatSelect">
                <option value="">Select Format</option>
                <option value="A1">A1</option>
                <option value="A2">A2</option>
                <option value="A3">A3</option>
                <option value="A4">A4</option>
                <option value="A5">A5</option>
                <option value="A6">A6</option>
                <option value="custom">Custom Format</option>
            </select>
            <input type="text" name="custom_format" 
                   class="custom-field" 
                   placeholder="Specify dimensions (mm)"
                   id="customFormat">
            <div id="selectedFormats" class="selected-items"></div>
        </div>

        <div class="form-group">
            <label>Print Type:</label>
            <select name="print_type" id="printType">
                <option value="">Select Print Type</option>
                <option value="konica">Konica</option>
                <option value="konica_label">Konica Label</option>
                <option value="wide_format">Wide Format Printing</option>
                <option value="plotter_cutting">Plotter Cutting</option>
                <option value="newspaper_printing">Newspaper Printing</option>
                <option value="heidelberg_printing">Heidelberg Printing</option>
            </select>
            <div id="selectedPrintTypes" class="selected-items"></div>
        </div>

        <div class="form-group">
            <label>Material:</label>
            <select name="material" id="materialSelect">
                <option value="">Select Material</option>
                <option value="offset">Offset</option>
                <option value="glossy_chalk">Glossy Chalk</option>
                <option value="matte_chalk">Matte Chalk</option>
                <option value="self_adhesive">Self-adhesive</option>
                <option value="blueback">Blueback</option>
                <option value="citylight">Citylight</option>
                <option value="banner">Banner</option>
                <option value="film_white">Film: 010 White</option>
                <option value="film_matte">Film: 010 Matte</option>
                <option value="perforated_film">Film: Perforated</option>
                <option value="orafol_soundproof">Film: Orafol Soundproof</option>
                <option value="film_label_white_propylene">Film: White Propylene</option>
                <option value="film_linen">Film: Linen</option>
                <option value="film_kraft">Film: Kraft</option>
                <option value="film_grey_propylene">Film: Grey Propylene</option>
                <option value="film_transparent_propylene">Film: Transparent Propylene</option>
                <option value="newspaper">Newspaper</option>
                <option value="design_cardboard">Design Cardboard</option>
                <option value="other">Other Material</option>
            </select>
            <input type="text" name="custom_material" 
                   class="custom-field" 
                   placeholder="Specify material"
                   id="customMaterial">
            <div id="selectedMaterials" class="selected-items"></div>
        </div>

        <div class="form-group">
            <label>Paper Weight:</label>
            <select id="paperWeightSelect" name="paper_weight">
                <option value="">Select Weight</option>
                <option value="70">70 g/mÂ²</option>
                <option value="80">80 g/mÂ²</option>
                <option value="90">90 g/mÂ²</option>
                <option value="115">115 g/mÂ²</option>
                <option value="130">130 g/mÂ²</option>
                <option value="150">150 g/mÂ²</option>
                <option value="200">200 g/mÂ²</option>
                <option value="250">250 g/mÂ²</option>
                <option value="300">300 g/mÂ²</option>
                <option value="350">350 g/mÂ²</option>
                <option value="other">Other</option>
            </select>
            <input type="text" name="custom_paper_weight" 
                   class="custom-field" 
                   placeholder="Specify weight (g/mÂ²)"
                   id="customPaperWeight">
            <div id="selectedPaperWeights" class="selected-items"></div>
        </div>

        <div class="form-group">
            <label>Deadline:</label>
            <input type="date" name="deadline" required>
        </div>

        <div class="section-title">Post-Print Processing</div>
        <div class="form-group">
            <label>Post-Print Processing:</label>
            <select id="postPrintSelect">
                <option value="">Select Processing Type</option>
                <option value="folding">Folding</option>
                <option value="creasing">Creasing</option>
                <option value="stapling">Stapling</option>
                <option value="binding">Binding</option>
                <option value="perforation">Perforation</option>
                <option value="die_cutting">Die Cutting</option>
                <option value="spring">Spring Binding</option>
                <option value="guillotine">Guillotine Cutting</option>
                <option value="manual_cutting">Manual Cutting</option>
                <option value="plotter_cutting">Plotter Cutting</option>
                <option value="film_lamination">Film Lamination on PVC</option>
                <option value="banner_gluing">Banner Gluing</option>
                <option value="eyelets">Eyelets</option>
                <option value="glossy_lamination">Glossy Lamination</option>
                <option value="matte_lamination">Matte Lamination</option>
                <option value="velvet_lamination">Velvet Lamination</option>
                <option value="double_sided_lamination">Double-sided Lamination</option>
                <option value="pockets">Pockets</option>
                <option value="other">Other</option>
            </select>
            <div id="selectedPostPrint" class="selected-items"></div>
        </div>

        <div id="eyeletsFields" style="display: none; margin-top: 10px;">
            <label for="eyeletsQuantity">Number of Eyelets:</label>
            <input type="number" id="eyeletsQuantity" name="eyelets_quantity" min="1" placeholder="Enter quantity">
            <label for="eyeletsDistance">Distance Between Eyelets (mm):</label>
            <input type="number" id="eyeletsDistance" name="eyelets_distance" min="1" placeholder="Enter distance">
        </div>

        <div id="pocketsFields" style="display: none; margin-top: 10px;">
            <label for="pocketSize">Pocket Size (mm):</label>
            <input type="text" id="pocketSize" name="pocket_size" placeholder="E.g., 100x50">
            <label for="noodleColor">Pocket Noodle Color:</label>
            <select id="noodleColor" name="noodle_color">
                <option value="">Select Color</option>
                <option value="white">White</option>
                <option value="black">Black</option>
                <option value="red">Red</option>
                <option value="blue">Blue</option>
                <option value="green">Green</option>
                <option value="yellow">Yellow</option>
                <option value="custom">Custom</option>
            </select>
            <input type="text" id="customNoodleColor" name="custom_noodle_color" 
                   class="custom-field" placeholder="Specify color" style="display: none;">
        </div>

        <div class="form-group">
            <label>Notes:</label>
            <textarea name="notes" rows="4" placeholder="Additional requests"></textarea>
        </div>

        <div style="text-align: center; margin-top: 30px;">
            <button type="button" onclick="sendOrder()">Print Order Form</button>
            <button type="button" onclick="sendToGmail()">Send to Gmail</button>
            <button type="button" onclick="showInstructions()">Instructions</button>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <p>Â© 2025 PrintMediaPro. All rights reserved.</p>
            <div class="social-links">
                <a href="#"><i class="fab fa-instagram"></i></a>
                <a href="#"><i class="fab fa-facebook-f"></i></a>
            </div>
        </div>
    </footer>

    <script>
        // Original XLSX script
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};

        function loadFileData(filename) {
            if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
                try {
                    var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                    var firstSheetName = workbook.SheetNames[0];
                    var worksheet = workbook.Sheets[firstSheetName];

                    // Convert sheet to JSON to filter blank rows
                    var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                    // Filter out blank rows (rows where all cells are empty, null, or undefined)
                    var filteredData = jsonData.filter(row =>
                        row.some(cell => cell !== '' && cell !== null && cell !== undefined)
                    );

                    // Convert filtered JSON back to CSV
                    var csv = XLSX.utils.aoa_to_sheet(filteredData); // Create a new sheet from filtered array of arrays
                    csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                    return csv;
                } catch (e) {
                    console.error(e);
                    return "";
                }
            }
            return gk_fileData[filename] || "";
        }

        // Hamburger Menu
        const menuToggle = document.querySelector('.menu-toggle');
        const navUl = document.querySelector('nav ul');

        menuToggle.addEventListener('click', () => {
            navUl.classList.toggle('active');
        });

        // Smooth Scrolling
        document.querySelectorAll('nav a').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                const href = this.getAttribute('href');
                if (href.includes('#')) {
                    e.preventDefault();
                    const targetId = href.split('#')[1];
                    const targetElement = document.getElementById(targetId);
                    if (targetElement) {
                        window.scrollTo({
                            top: targetElement.offsetTop - 60,
                            behavior: 'smooth'
                        });
                    }
                }
            });
        });

        // Language Switcher
        const languageToggle = document.getElementById('language-toggle');
        const languageOptions = document.getElementById('language-options');

        if (languageToggle && languageOptions) {
            languageOptions.style.display = 'none';

            languageToggle.addEventListener('click', (e) => {
                e.stopPropagation();
                const isVisible = languageOptions.style.display === 'block';
                languageOptions.style.display = isVisible ? 'none' : 'block';
            });

            document.addEventListener('click', (e) => {
                if (!languageToggle.contains(e.target) && !languageOptions.contains(e.target)) {
                    languageOptions.style.display = 'none';
                }
            });

            // Update button text based on current page
            const currentLang = window.location.pathname.includes('order_uk.html') ? 'UK' :
                               window.location.pathname.includes('order_en.html') ? 'EN' : 'RU';
            languageToggle.textContent = currentLang;
        } else {
            console.error('Language toggle elements not found');
        }

        // Original JavaScript code for the form
        let selectedFiles = [];

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('orderDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('orderNumber').textContent = 
                Math.floor(Math.random() * 100000000).toString().padStart(8, '0');

            setupFileUpload();
            setupMultipleSelect('productName', 'selectedProducts', handleProductChange);
            setupMultipleSelect('printSides', 'selectedPrintSides');
            setupMultipleSelect('formatSelect', 'selectedFormats', handleFormatChange);
            setupMultipleSelect('printType', 'selectedPrintTypes', handlePrintTypeChange);
            setupMultipleSelect('materialSelect', 'selectedMaterials', handleMaterialChange);
            setupMultipleSelect('paperWeightSelect', 'selectedPaperWeights', handlePaperWeightChange);
            setupMultipleSelect('postPrintSelect', 'selectedPostPrint', handlePostPrintChange);

            document.querySelector('input[name="phone"]').addEventListener('input', function(e) {
                this.value = this.value.replace(/[^\d+]/g, '');
            });

            setupBindingTypeHandler();
            setupCalendarTypeHandler();
        });

        function setupFileUpload() {
            const fileInput = document.getElementById('fileUpload');
            const fileList = document.getElementById('fileList');

            fileInput.addEventListener('change', function() {
                const newFiles = Array.from(fileInput.files);
                newFiles.forEach(file => {
                    if (!selectedFiles.some(existingFile => existingFile.name === file.name)) {
                        selectedFiles.push(file);
                        addItem(fileList, file.name, 'removeFile', file.name);
                    }
                });
                fileInput.value = '';
            });

            window.removeFile = function(button, fileName) {
                selectedFiles = selectedFiles.filter(file => file.name !== fileName);
                button.parentElement.remove();
            };
        }

        function setupMultipleSelect(selectId, containerId, customHandler) {
            const select = document.getElementById(selectId);
            const container = document.getElementById(containerId);

            select.addEventListener('change', function() {
                const value = this.value;
                if (!value) return;

                if (customHandler) {
                    customHandler(value, container);
                } else {
                    const text = this.options[this.selectedIndex].text;
                    addItem(container, text, `remove${selectId.charAt(0).toUpperCase() + selectId.slice(1)}`, text);
                }
                this.value = '';
            });
        }

        function handleProductChange(value, container) {
            const bindingOptions = document.getElementById('bindingOptions');
            const calendarOptions = document.getElementById('calendarOptions');
            const customProduct = document.getElementById('customProduct');

            bindingOptions.style.display = (value === 'magazine' || value === 'book') ? 'block' : 'none';
            calendarOptions.style.display = value === 'calendar' ? 'block' : 'none';
            customProduct.style.display = value === 'other' ? 'block' : 'none';

            if (value === 'other') {
                customProduct.addEventListener('blur', function handler() {
                    if (this.value) {
                        addItem(container, this.value, 'removeProduct', this.value);
                        this.value = '';
                    }
                    this.removeEventListener('blur', handler);
                });
            } else if (value !== 'magazine' && value !== 'book' && value !== 'calendar') {
                const text = document.getElementById('productName').options[document.getElementById('productName').selectedIndex].text;
                addItem(container, text, 'removeProduct', text);
            }
        }

        function setupBindingTypeHandler() {
            const bindingType = document.getElementById('bindingType');
            const container = document.getElementById('selectedProducts');
            bindingType.addEventListener('change', function() {
                if (this.value) {
                    const productName = document.getElementById('productName').value === 'magazine' ? 'Magazine' : 'Book';
                    const bindingText = this.options[this.selectedIndex].text;
                    addItem(container, `${productName} (${bindingText})`, 'removeProduct', `${productName} (${bindingText})`);
                    this.value = '';
                }
            });
        }

        function setupCalendarTypeHandler() {
            const calendarType = document.getElementById('calendarType');
            const pageCount = document.getElementById('pageCount');
            const container = document.getElementById('selectedProducts');
            calendarType.addEventListener('change', function() {
                if (this.value) {
                    const calendarText = this.options[this.selectedIndex].text;
                    const pages = pageCount.value ? `, ${pageCount.value} pages` : '';
                    addItem(container, `Calendar (${calendarText}${pages})`, 'removeProduct', `Calendar (${calendarText}${pages})`);
                    this.value = '';
                    pageCount.value = '';
                }
            });
        }

        function handleFormatChange(value, container) {
            const customFormat = document.getElementById('customFormat');
            customFormat.style.display = value === 'custom' ? 'block' : 'none';

            if (value === 'custom') {
                customFormat.addEventListener('blur', function handler() {
                    if (this.value) {
                        addItem(container, this.value, 'removeFormat', this.value);
                        this.value = '';
                    }
                    this.removeEventListener('blur', handler);
                });
            } else {
                const text = document.getElementById('formatSelect').options[document.getElementById('formatSelect').selectedIndex].text;
                addItem(container, text, 'removeFormat', text);
            }
        }

        function handlePrintTypeChange(value, container) {
            const text = document.getElementById('printType').options[document.getElementById('printType').selectedIndex].text;
            addItem(container, text, 'removePrintType', text);
        }

        function handleMaterialChange(value, container) {
            const customMaterial = document.getElementById('customMaterial');
            customMaterial.style.display = value === 'other' ? 'block' : 'none';

            if (value === 'other') {
                customMaterial.addEventListener('blur', function handler() {
                    if (this.value) {
                        addItem(container, this.value, 'removeMaterial', this.value);
                        this.value = '';
                    }
                    this.removeEventListener('blur', handler);
                });
            } else {
                const text = document.getElementById('materialSelect').options[document.getElementById('materialSelect').selectedIndex].text;
                addItem(container, text, 'removeMaterial', text);
            }
        }

        function handlePaperWeightChange(value, container) {
            const customPaperWeight = document.getElementById('customPaperWeight');
            customPaperWeight.style.display = value === 'other' ? 'block' : 'none';

            if (value === 'other') {
                customPaperWeight.addEventListener('blur', function handler() {
                    if (this.value) {
                        addItem(container, `${this.value} g/mÂ²`, 'removePaperWeight', `${this.value} g/mÂ²`);
                        this.value = '';
                    }
                    this.removeEventListener('blur', handler);
                });
            } else {
                const text = document.getElementById('paperWeightSelect').options[document.getElementById('paperWeightSelect').selectedIndex].text;
                addItem(container, text, 'removePaperWeight', text);
            }
        }

        function handlePostPrintChange(value, container) {
            const eyeletsFields = document.getElementById('eyeletsFields');
            const pocketsFields = document.getElementById('pocketsFields');
            eyeletsFields.style.display = value === 'eyelets' ? 'block' : 'none';
            pocketsFields.style.display = value === 'pockets' ? 'block' : 'none';

            if (value === 'pockets') {
                document.getElementById('noodleColor').addEventListener('change', function handler() {
                    const customNoodleColor = document.getElementById('customNoodleColor');
                    customNoodleColor.style.display = this.value === 'custom' ? 'block' : 'none';
                    if (this.value === 'custom') {
                        customNoodleColor.addEventListener('blur', function subHandler() {
                            if (this.value) {
                                const pocketSize = document.getElementById('pocketSize').value;
                                const text = `Pockets (Size: ${pocketSize || 'not specified'} mm, Noodle Color: ${this.value})`;
                                addItem(container, text, 'removePostPrint', text);
                                this.value = '';
                            }
                            this.removeEventListener('blur', subHandler);
                        });
                    } else if (this.value) {
                        const pocketSize = document.getElementById('pocketSize').value;
                        const text = `Pockets (Size: ${pocketSize || 'not specified'} mm, Noodle Color: ${this.options[this.selectedIndex].text})`;
                        addItem(container, text, 'removePostPrint', text);
                        this.value = '';
                    }
                    this.removeEventListener('change', handler);
                });
            } else {
                const text = document.getElementById('postPrintSelect').options[document.getElementById('postPrintSelect').selectedIndex].text;
                addItem(container, text, 'removePostPrint', text);
            }
        }

        function addItem(container, text, removeFunctionName, identifier) {
            const itemDiv = document.createElement('div');
            itemDiv.className = 'selected-item';
            itemDiv.innerHTML = `<span>${text}</span><button type="button" class="remove-button" onclick="${removeFunctionName}(this, '${identifier.replace(/'/g, "\\'")}')">Remove</button>`;
            container.appendChild(itemDiv);
        }

        window.removeProduct = function(button) { button.parentElement.remove(); };
        window.removePrintSides = function(button) { button.parentElement.remove(); };
        window.removeFormat = function(button) { button.parentElement.remove(); };
        window.removePrintType = function(button) { button.parentElement.remove(); };
        window.removeMaterial = function(button) { button.parentElement.remove(); };
        window.removePaperWeight = function(button) { button.parentElement.remove(); };
        window.removePostPrint = function(button) { button.parentElement.remove(); };

        function generateOrderTable() {
            const formData = {
                orderNumber: document.getElementById('orderNumber').textContent,
                orderDate: document.getElementById('orderDate').value,
                customer: document.querySelector('input[name="customer"]').value,
                contactPerson: document.querySelector('input[name="contact_person"]').value,
                phone: document.querySelector('input[name="phone"]').value,
                email: document.querySelector('input[name="email"]').value,
                filename: selectedFiles.map(file => file.name).join(', ') || 'Not specified',
                product: getSelectedItems('selectedProducts'),
                printSides: getSelectedItems('selectedPrintSides'),
                quantity: document.querySelector('input[name="quantity"]').value,
                format: getSelectedItems('selectedFormats'),
                printType: getSelectedItems('selectedPrintTypes'),
                material: getSelectedItems('selectedMaterials'),
                paperWeight: getSelectedItems('selectedPaperWeights'),
                deadline: document.querySelector('input[name="deadline"]').value,
                postPrint: getSelectedItems('selectedPostPrint'),
                eyeletsQuantity: document.getElementById('eyeletsQuantity').value,
                eyeletsDistance: document.getElementById('eyeletsDistance').value,
                pocketSize: document.getElementById('pocketSize').value,
                notes: document.querySelector('textarea[name="notes"]').value || 'None'
            };

            return `
                <div class="order-table" style="font-family: Arial, sans-serif; padding: 20px; background: white; width: 800px; position: relative;">
                    <a href="index.html"><img src="https://printtmedia.github.io/printmediapro/Logo%20printmediapro.png" alt="Print Media Pro Logo" style="position: absolute; top: 20px; left: 20px; width: 150px; height: auto;"></a>
                    <h2 style="text-align: center; color: #4F46E5; margin-top: 80px;">ORDER FORM â„–${formData.orderNumber}</h2>
                    <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                        <tr><th style="border: 1px solid #E5E7EB; padding: 8px; background-color: #F9FAFB;">Parameter</th><th style="border: 1px solid #E5E7EB; padding: 8px; background-color: #F9FAFB;">Value</th></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Order Date</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.orderDate}</td></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Customer</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.customer}</td></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Contact Person</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.contactPerson}</td></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Phone</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.phone}</td></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Email</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.email}</td></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">File Name</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.filename}</td></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Product Name</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.product}</td></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Print Sides</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.printSides}</td></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Quantity</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.quantity}</td></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Format</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.format}</td></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Print Type</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.printType}</td></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Material</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.material}</td></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Paper Weight</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.paperWeight}</td></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Deadline</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.deadline}</td></tr>
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Post-Print Processing</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.postPrint}</td></tr>
                        ${formData.eyeletsQuantity ? `<tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Number of Eyelets</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.eyeletsQuantity}</td></tr>` : ''}
                        ${formData.eyeletsDistance ? `<tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Distance Between Eyelets</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.eyeletsDistance} mm</td></tr>` : ''}
                        ${formData.pocketSize ? `<tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Pocket Size</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.pocketSize} mm</td></tr>` : ''}
                        <tr><td style="border: 1px solid #E5E7EB; padding: 8px;">Notes</td><td style="border: 1px solid #E5E7EB; padding: 8px;">${formData.notes}</td></tr>
                    </table>
                </div>
            `;
        }

        function getSelectedItems(containerId) {
            const items = document.querySelectorAll(`#${containerId} .selected-item span`);
            return Array.from(items).map(item => item.textContent).join(', ') || 'Not selected';
        }

        function sendOrder() {
            try {
                const orderTable = generateOrderTable();
                const printWindow = window.open('', '_blank');
                if (!printWindow) throw new Error('Failed to open print window.');
                printWindow.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head><title>Print Order</title><style>@media print { body { margin: 0; padding: 0; } .order-table { width: 100%; } table, th, td { border: 1px solid black; font-size: 12pt; font-weight: 600; } }</style></head>
                    <body>${orderTable}</body>
                    </html>
                `);
                printWindow.document.close();
                printWindow.focus();
                setTimeout(() => {
                    printWindow.print();
                    printWindow.close();
                }, 500);
            } catch (error) {
                console.error('Error during printing:', error);
                alert('Failed to print the order.');
            }
        }

        function sendToGmail() {
            try {
                const formData = { orderNumber: document.getElementById('orderNumber').textContent };
                const tempDiv = document.createElement('div');
                tempDiv.style.position = 'absolute';
                tempDiv.style.left = '-9999px';
                tempDiv.innerHTML = generateOrderTable();
                document.body.appendChild(tempDiv);

                html2canvas(tempDiv.querySelector('.order-table'), {
                    scale: 2,
                    useCORS: true,
                    logging: false
                }).then(canvas => {
                    const imgData = canvas.toDataURL('image/png', 1.0);
                    const folderName = `Order Form â„–${formData.orderNumber}`;
                    const fileName = `${folderName}.png`;

                    if (window.showDirectoryPicker) {
                        saveWithFolder(imgData, folderName, fileName).then(() => proceedWithEmail(folderName));
                    } else {
                        fallbackDownload(imgData, folderName, fileName);
                    }
                    document.body.removeChild(tempDiv);
                }).catch(error => {
                    console.error('html2canvas error:', error);
                    document.body.removeChild(tempDiv);
                    alert('Error creating image.');
                });
            } catch (error) {
                console.error('Error during sending:', error);
                alert('Failed to send the order.');
            }
        }

        async function saveWithFolder(imgData, folderName, fileName) {
            const dirHandle = await window.showDirectoryPicker({ mode: 'readwrite' });
            const subDirHandle = await dirHandle.getDirectoryHandle(folderName, { create: true });
            const fileHandle = await subDirHandle.getFileHandle(fileName, { create: true });
            const writable = await fileHandle.createWritable();
            const response = await fetch(imgData);
            const blob = await response.blob();
            await writable.write(blob);
            await writable.close();
        }

        function fallbackDownload(imgData, folderName, fileName) {
            const link = document.createElement('a');
            link.href = imgData;
            link.download = `${folderName}/${fileName}`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            proceedWithEmail(folderName);
        }

        function proceedWithEmail(folderName) {
            const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
            const subject = `Order Form â„–${folderName.split('â„–')[1]}`;
            if (isMobile) {
                window.location.href = `mailto:printmediapro@gmail.com?subject=${encodeURIComponent(subject)}`;
            } else {
                window.open(`https://mail.google.com/mail/?view=cm&fs=1&to=printmediapro@gmail.com&su=${encodeURIComponent(subject)}`, '_blank');
            }
        }

        function showInstructions() {
            try {
                const instructionWindow = window.open('', '_blank');
                if (!instructionWindow) throw new Error('Failed to open instruction window.');
                instructionWindow.document.write(`
                    <!DOCTYPE html>
                    <html lang="en">
                    <head>
                        <meta charset="UTF-8">
                        <title>Instructions for Using the Form</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; background-color: #f4f4f4; color: #333; }
                            h1 { color: #4F46E5; text-align: center; }
                            h2 { color: #1A237E; margin-top: 20px; }
                            p, li { font-size: 16px; }
                            ul { margin-left: 20px; }
                            .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
                        </style>
                    </head>
                    <body>
                        <div class="container">
                            <h1>Instructions for Using the "Order Form for Printing Services"</h1>
                            <p>This form is designed for placing orders for printing services (business cards, banners, books, etc.). You can fill in the fields, select multiple options where applicable, and either print the order or send it to Gmail. Hereâ€™s a step-by-step guide:</p>

                            <h2>1. Basic Information</h2>
                            <ul>
                                <li><b>Order Date</b>: Automatically set to the current date (e.g., 04/15/2025). Change if needed by selecting a date from the calendar.</li>
                                <li><b>Customer</b>: Enter the company name or customerâ€™s name (e.g., "ABC Corp" or "John Doe").</li>
                                <li><b>Contact Person</b>: Enter the name of the contact person (e.g., "Jane Smith").</li>
                                <li><b>Phone</b>: Enter the phone number in the format +380XXXXXXXXX (e.g., +380501234567). Use only digits and "+".</li>
                                <li><b>Email</b>: Enter the email for contact (e.g., "jane@example.com").</li>
                                <li><b>File Name</b>: Click "Choose File" to upload layouts (PDF, JPG, PNG, DOCX). You can select multiple files (hold Ctrl and click files on Windows, or Command on Mac). After selection, the files will appear in the list below with a "Remove" button. To remove a file from the list, click "Remove" next to its name.</li>
                            </ul>

                            <h2>2. Product Specifications</h2>
                            <p>All fields allow selecting multiple values if needed. Selected items appear in the list below with a "Remove" button.</p>
                            <ul>
                                <li><b>Product Name</b>: Select from the list (e.g., "Business Card", "Banner"). After selection, the item will be added to the list (e.g., "Business Card [Remove]"). You can add multiple items. To remove, click "Remove".
                                    <ul>
                                        <li>If you select "Magazine" or "Book", a "Type" field will appear: choose "Soft Binding" or "Hard Binding" â€” it will be added as, e.g., "Book (Soft Binding) [Remove]".</li>
                                        <li>If you select "Calendar", specify "Calendar Type" ("Cover" or "Inner Block") and "Number of Pages" (e.g., 12) â€” it will be added as "Calendar (Cover, 12 pages) [Remove]".</li>
                                        <li>If you select "Other", enter the name (e.g., "Sticker") and press Tab or click outside the field â€” it will be added as "Sticker [Remove]".</li>
                                    </ul>
                                </li>
                                <li><b>Print Sides</b>: Choose "Single-sided (4+0)" or "Double-sided (4+4)". It will be added to the list (e.g., "4+0 [Remove]"). You can select both options. Remove errors by clicking "Remove".</li>
                                <li><b>Quantity</b>: Specify the number of copies (e.g., 100).</li>
                                <li><b>Format</b>: Select from the list (e.g., "A4") or "Custom Format" and specify dimensions (e.g., "100x200 mm"). It will be added to the list (e.g., "A4 [Remove]"). You can select multiple formats. Remove extras by clicking "Remove".</li>
                                <li><b>Print Type</b>: Select from the list (e.g., "Konica", "Wide Format Printing"). It will be added to the list (e.g., "Konica [Remove]"). You can select multiple types. Remove unnecessary ones by clicking "Remove".</li>
                                <li><b>Material</b>: Select the material (e.g., "Offset") or "Other Material" and specify your own (e.g., "Cardboard"). It will be added to the list. Remove if needed.</li>
                                <li><b>Paper Weight</b>: Select from the list (e.g., "80 g/mÂ²") or "Other" and specify the value (e.g., "200"). It will be added to the list (e.g., "80 g/mÂ² [Remove]"). You can select multiple weights. Remove extras.</li>
                                <li><b>Deadline</b>: Select the date from the calendar (e.g., 04/20/2025).</li>
                            </ul>

                            <h2>3. Post-Print Processing</h2>
                            <ul>
                                <li><b>Post-Print Processing</b>: Select the type of processing (e.g., "Glossy Lamination"). It will be added to the list. You can select multiple types.
                                    <ul>
                                        <li>If you select "Eyelets", specify "Number of Eyelets" (e.g., 4) and "Distance Between Eyelets" (e.g., 100 mm) â€” this data will be included in the table.</li>
                                        <li>If you select "Pockets", specify "Pocket Size" (e.g., "100x50") and "Noodle Color" (e.g., "Red" or "Custom" and your color, e.g., "Silver") â€” it will be added as "Pockets (Size: 100x50 mm, Noodle Color: Red) [Remove]".</li>
                                    </ul>
                                    Remove unnecessary items by clicking "Remove".
                                </li>
                            </ul>

                            <h2>4. Notes</h2>
                            <ul>
                                <li><b>Notes</b>: Enter additional requests (e.g., "Urgent order"). Leave blank if not needed.</li>
                            </ul>

                            <h2>5. Actions with the Order</h2>
                            <ul>
                                <li><b>Print Order Form</b>: Click to open a window with the order table. Click "Print" in the browser to send to the printer.</li>
                                <li><b>Send to Gmail</b>: Click to save a PNG file of the table in a folder named "Order Form â„–XXXXXX". Then Gmail (on a computer) or your email app (on a mobile device) will open with the pre-filled address printmediapro@gmail.com and subject "Order Form â„–XXXXXX". Attach the files manually and send the email. If Gmail does not open, manually send an email to printmediapro@gmail.com.</li>
                                <li><b>Instructions</b>: Click to open this window with the instructions.</li>
                            </ul>
                        </div>
                    </body>
                    </html>
                `);
                instructionWindow.document.close();
            } catch (error) {
                console.error('Instruction error:', error);
                alert('Failed to open instructions.');
            }
        }
    </script>
    <!-- Cloudflare Web Analytics -->
    <script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "a4b1a8a9c0e84c1b9e1e5e5e5e5e5e5e"}'></script>
</body>
</html>